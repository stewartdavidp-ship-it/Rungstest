<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Rungs - Daily Puzzle</title>
    <style>
        :root {
            /* Dark theme (default) */
            --bg-primary: #1a1520;
            --bg-secondary: #2d2535;
            --bg-tertiary: #252030;
            --bg-hover: #3d3548;
            --bg-selected: #4a3555;
            --text-primary: #e8e0f0;
            --text-secondary: #a89fb0;
            --text-muted: #6a5f7a;
            --accent-gold: #ffd369;
            --accent-pink: #ff6b9d;
            --accent-success: #4ade80;
            --accent-error: #f87171;
            --border-color: #3d3548;
            --border-light: #5a4f6a;
            --shadow-glow: rgba(255, 107, 157, 0.3);
        }

        [data-theme="light"] {
            --bg-primary: #f5f3f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #ebe8ef;
            --bg-hover: #e0dce5;
            --bg-selected: #d4cfe0;
            --text-primary: #2d2535;
            --text-secondary: #5a4f6a;
            --text-muted: #8a7f9a;
            --accent-gold: #c9a030;
            --accent-pink: #d4527a;
            --accent-success: #2d8a4e;
            --accent-error: #c94444;
            --border-color: #d0c8d8;
            --border-light: #b8b0c0;
            --shadow-glow: rgba(212, 82, 122, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            transition: background 0.3s, color 0.3s;
        }

        .container {
            max-width: 420px;
            width: 100%;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 300;
            letter-spacing: 0.5rem;
            color: var(--accent-gold);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all 0.3s;
        }

        .subtitle.hint-revealed {
            color: var(--accent-gold);
            font-weight: 600;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            margin: 5px 0;
        }

        .difficulty-badge.easy {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .difficulty-badge.medium {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .difficulty-badge.hard {
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
        }

        /* Attempts */
        .attempts {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
        }

        .attempt-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--border-color);
            border: 2px solid var(--border-light);
            transition: all 0.3s;
        }

        .attempt-dot.active {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
        }

        .attempt-dot.used {
            background: var(--accent-error);
            border-color: var(--accent-error);
        }

        /* Item Pool */
        .pool {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .item {
            aspect-ratio: 1;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            padding: 8px;
            text-align: center;
            word-break: break-word;
        }

        .item:hover {
            background: var(--bg-hover);
        }

        .item.selected {
            background: var(--bg-selected);
            border-color: var(--accent-pink);
            box-shadow: 0 0 15px var(--shadow-glow);
        }

        .item.stacked {
            opacity: 0;
            pointer-events: none;
        }

        .item .emoji {
            font-size: 1.8rem;
        }

        /* Divider */
        .divider {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--border-light), transparent);
            margin: 10px 0 20px;
        }

        /* Stack Area */
        .stack-area {
            display: flex;
            flex-direction: column-reverse;
            gap: 8px;
            margin-bottom: 20px;
        }

        .stack-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stack-number {
            width: 24px;
            font-size: 0.9rem;
            color: var(--text-muted);
            text-align: center;
        }

        .stack-slot {
            flex: 1;
            height: 50px;
            background: var(--bg-tertiary);
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 1rem;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .stack-slot.filled {
            background: var(--bg-hover);
            border-style: solid;
            border-color: var(--border-light);
            color: var(--text-primary);
            cursor: pointer;
            position: relative;
        }

        .stack-slot.filled:hover {
            background: var(--bg-selected);
        }

        .stack-slot.selected {
            border-color: var(--accent-pink);
            box-shadow: 0 0 15px var(--shadow-glow);
        }

        .stack-slot .pair-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stack-slot .pair-divider {
            color: var(--accent-gold);
            font-weight: bold;
        }

        .stack-slot .drag-handle {
            position: absolute;
            right: 10px;
            color: var(--text-muted);
            cursor: grab;
            font-size: 1.2rem;
            letter-spacing: -3px;
            opacity: 0.5;
        }

        .stack-slot.filled:hover .drag-handle {
            opacity: 1;
        }

        .stack-slot .reorder-btns {
            position: absolute;
            right: 8px;
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .stack-slot .reorder-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            width: 24px;
            height: 18px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            padding: 0;
            transition: all 0.15s;
        }

        .stack-slot .reorder-btn:hover {
            background: var(--accent-pink);
            color: white;
            border-color: var(--accent-pink);
        }

        .stack-slot .reorder-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .stack-slot .reorder-btn:disabled:hover {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .stack-slot.drag-over {
            border-color: var(--accent-gold);
            background: var(--bg-selected);
        }

        .stack-slot.dragging {
            opacity: 0.5;
        }

        /* Buttons */
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-pink), var(--accent-gold));
            color: var(--bg-primary);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px var(--shadow-glow);
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--bg-selected);
        }

        .btn-danger {
            background: #5a3040;
            color: var(--accent-error);
        }

        .btn-danger:hover:not(:disabled) {
            background: #6a3a50;
        }

        .btn-success {
            background: #2a5a40;
            color: var(--accent-success);
        }

        .btn-success:hover:not(:disabled) {
            background: #3a6a50;
        }

        /* Result Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 8, 15, 0.95);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        [data-theme="light"] .modal {
            background: rgba(100, 90, 110, 0.9);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 30px;
            max-width: 360px;
            width: 100%;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-hover);
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .modal-close-btn:hover {
            background: var(--bg-selected);
            color: var(--text-primary);
        }

        .modal h2 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--accent-gold);
        }

        .modal h2.success {
            color: var(--accent-success);
        }

        .modal h2.fail {
            color: var(--accent-error);
        }

        .result-pairs {
            text-align: left;
            margin: 20px 0;
        }

        .result-pair {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .result-pair .pair-text {
            font-size: 0.95rem;
        }

        .result-pair .pair-status {
            font-size: 1.2rem;
        }

        .result-order {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 600;
        }

        .result-order.correct {
            color: var(--accent-success);
        }

        .result-order.incorrect {
            color: var(--accent-error);
        }

        .attempts-remaining {
            margin: 15px 0;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Tell Me More Section */
        .tell-me-more-btn {
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-top: 15px;
            transition: all 0.2s;
        }

        .tell-me-more-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
            border-color: var(--accent-gold);
        }

        .detailed-explanation {
            display: none;
            margin-top: 15px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border-left: 3px solid var(--accent-gold);
            text-align: left;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .detailed-explanation.show {
            display: block;
        }

        .detailed-explanation h4 {
            color: var(--accent-gold);
            margin: 0 0 10px 0;
            font-size: 0.95rem;
        }

        .detailed-explanation table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }

        .detailed-explanation th,
        .detailed-explanation td {
            padding: 6px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.85rem;
        }

        .detailed-explanation th {
            color: var(--accent-gold);
            font-weight: 600;
        }

        /* Bonus Round */
        .bonus-section {
            margin-top: 20px;
        }

        .bonus-section label {
            display: block;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .bonus-select {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        /* Win/Lose screens */
        .final-result {
            font-size: 3rem;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .stat-box {
            background: var(--bg-tertiary);
            padding: 15px 10px;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-gold);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Share button */
        .share-text {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            margin: 15px 0;
            white-space: pre-line;
        }

        /* Message toast */
        .message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--bg-secondary);
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: 500;
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .message.show {
            opacity: 1;
        }

        .message.success {
            border: 2px solid var(--accent-success);
            color: var(--accent-success);
        }

        .message.error {
            border: 2px solid var(--accent-error);
            color: var(--accent-error);
        }

        /* Footer */
        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }

        .mode-btn {
            padding: 6px 14px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn:hover {
            border-color: var(--border-light);
            color: var(--text-primary);
        }

        .mode-btn.active {
            background: var(--bg-hover);
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        /* Hamburger Menu */
        .hamburger-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 50;
        }

        .hamburger-btn span {
            display: block;
            width: 22px;
            height: 2px;
            background: var(--text-secondary);
            transition: all 0.2s;
        }

        .hamburger-btn:hover span {
            background: var(--accent-gold);
        }

        /* Menu Modal */
        .menu-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 8, 15, 0.95);
            z-index: 150;
            align-items: flex-start;
            justify-content: center;
            padding: 40px 20px 20px;
            overflow-y: auto;
        }

        [data-theme="light"] .menu-modal {
            background: rgba(100, 90, 110, 0.95);
        }

        .menu-modal.active {
            display: flex;
        }

        .menu-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 20px;
            max-width: 320px;
            width: 100%;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
        }

        .menu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .menu-header h3 {
            font-size: 1.2rem;
            color: var(--accent-gold);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }

        .close-btn:hover {
            color: var(--accent-error);
        }

        .menu-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background: var(--bg-hover);
        }

        .menu-item-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .menu-item-icon {
            font-size: 1.2rem;
        }

        .menu-item-text {
            font-weight: 500;
        }

        .menu-item-arrow {
            color: var(--text-muted);
        }

        /* Toggle Switch (simple) */
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: var(--border-color);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toggle-switch.active {
            background: var(--accent-gold);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            background: var(--bg-secondary);
            border-radius: 50%;
            transition: all 0.3s;
        }

        .toggle-switch.active::after {
            left: 27px;
        }

        /* Toggle (checkbox-based) */
        .toggle {
            position: relative;
            width: 50px;
            height: 28px;
        }

        .toggle input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
            margin: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: 0.3s;
            border-radius: 28px;
            z-index: 1;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: var(--text-secondary);
            transition: 0.3s;
            border-radius: 50%;
        }

        .toggle input:checked + .toggle-slider {
            background-color: var(--accent-gold);
        }

        .toggle input:checked + .toggle-slider:before {
            transform: translateX(22px);
            background-color: var(--bg-primary);
        }

        /* Stats Display */
        .stats-container {
            text-align: left;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stats-label {
            color: var(--text-secondary);
        }

        .stats-value {
            font-weight: 600;
            color: var(--accent-gold);
        }

        .streak-display {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 15px;
        }

        .streak-item {
            text-align: center;
        }

        .streak-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-gold);
        }

        .streak-value.fire::after {
            content: 'üî•';
            margin-left: 5px;
        }

        .streak-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .streak-fire {
            font-size: 1.2rem;
        }

        /* Menu Section */
        .menu-section {
            margin-bottom: 25px;
        }

        .menu-section:last-child {
            margin-bottom: 0;
        }

        .menu-section h3 {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 12px;
        }

        /* About Section */
        .about-text {
            text-align: left;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .about-text p {
            margin-bottom: 10px;
        }

        .about-text p:last-child {
            margin-bottom: 0;
        }

        .about-text strong {
            color: var(--accent-gold);
        }

        .about-text h4 {
            color: var(--accent-gold);
            margin: 15px 0 8px;
        }

        .about-text h4:first-child {
            margin-top: 0;
        }

        /* Utility Classes */
        .text-secondary {
            color: var(--text-secondary);
        }

        .text-accent {
            color: var(--accent-gold);
        }

        /* Responsive */
        @media (max-width: 380px) {
            .container {
                padding: 10px;
            }

            .header {
                margin-bottom: 10px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .subtitle {
                font-size: 0.85rem;
            }

            .pool {
                gap: 6px;
                margin-bottom: 12px;
            }

            .item {
                font-size: 0.75rem;
                padding: 4px;
                border-radius: 8px;
            }
            
            .item .emoji {
                font-size: 1.5rem;
            }

            .divider {
                margin: 6px 0 12px;
            }

            .stack-area {
                gap: 6px;
                margin-bottom: 12px;
            }

            .stack-slot {
                height: 42px;
                font-size: 0.85rem;
            }

            .buttons {
                gap: 6px;
            }

            .btn {
                padding: 10px 14px;
                font-size: 0.85rem;
            }

            .footer {
                margin-top: 10px;
                font-size: 0.7rem;
            }
        }

        @media (max-width: 340px) {
            .item {
                font-size: 0.7rem;
            }
            
            .stack-slot {
                height: 38px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container" style="position: relative;">
        <!-- Menu Button -->
        <button class="hamburger-btn" onclick="openMenu()" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <header class="header">
            <h1>RUNGS</h1>
            <div class="subtitle" id="subtitle">Pair the words. Climb the rungs.</div>
            <div class="difficulty-badge" id="difficulty-badge"></div>
            <div class="attempts" id="attempts">
                <div class="attempt-dot active"></div>
                <div class="attempt-dot"></div>
                <div class="attempt-dot"></div>
                <div class="attempt-dot"></div>
            </div>
        </header>

        <div class="pool" id="pool"></div>

        <div class="divider"></div>

        <div class="stack-area" id="stack-area">
            <div class="stack-row">
                <div class="stack-number">1</div>
                <div class="stack-slot" id="slot-0" data-slot="0"></div>
            </div>
            <div class="stack-row">
                <div class="stack-number">2</div>
                <div class="stack-slot" id="slot-1" data-slot="1"></div>
            </div>
            <div class="stack-row">
                <div class="stack-number">3</div>
                <div class="stack-slot" id="slot-2" data-slot="2"></div>
            </div>
            <div class="stack-row">
                <div class="stack-number">4</div>
                <div class="stack-slot" id="slot-3" data-slot="3"></div>
            </div>
        </div>

        <div class="buttons">
            <button class="btn btn-primary" id="stack-btn" disabled onclick="stackSelected()">Place</button>
            <button class="btn btn-danger" id="unstack-btn" disabled onclick="unstackSelected()">Remove</button>
            <button class="btn btn-secondary" id="reset-btn" disabled onclick="resetGame()">Reset</button>
            <button class="btn btn-success" id="submit-btn" disabled onclick="validateStack()">Submit</button>
        </div>

        <footer class="footer">
            v2.6.0 ‚Ä¢ Rungs
        </footer>
    </div>

    <!-- Result Modal -->
    <div class="modal" id="result-modal">
        <div class="modal-content" id="result-content">
            <!-- Filled dynamically -->
        </div>
    </div>

    <!-- Message Toast -->
    <div class="message" id="message"></div>

    <!-- Menu Modal -->
    <div class="menu-modal" id="menu-modal">
        <div class="menu-content">
            <div class="menu-header">
                <h2>Menu</h2>
                <button class="close-btn" onclick="closeMenu()">&times;</button>
            </div>

            <!-- Stats Section -->
            <div class="menu-section">
                <h3>Statistics</h3>
                <div class="streak-display">
                    <div class="streak-item">
                        <div class="streak-value fire" id="current-streak">0</div>
                        <div class="streak-label">Current Streak</div>
                    </div>
                    <div class="streak-item">
                        <div class="streak-value" id="max-streak">0</div>
                        <div class="streak-label">Best Streak</div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-value" id="games-played">0</div>
                        <div class="stat-label">Played</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="win-rate">0%</div>
                        <div class="stat-label">Win Rate</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="games-won">0</div>
                        <div class="stat-label">Won</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avg-attempts">-</div>
                        <div class="stat-label">Avg Attempts</div>
                    </div>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="menu-section">
                <h3>Settings</h3>
                <div class="menu-item">
                    <label>Hard Mode</label>
                    <div class="toggle">
                        <input type="checkbox" id="hard-mode-toggle" onchange="toggleHardMode()">
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                <div class="menu-item">
                    <label>Dark Mode</label>
                    <div class="toggle">
                        <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                <div class="menu-item">
                    <label>Show Intro on Start</label>
                    <div class="toggle">
                        <input type="checkbox" id="intro-toggle" onchange="toggleIntroSetting()" checked>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
            </div>

            <!-- About Section -->
            <div class="menu-section">
                <h3>About</h3>
                <div class="about-text">
                    <p><strong>Rungs</strong> is a daily word puzzle game.</p>
                    <p>Your goal is to pair 8 items (words, numbers, or emojis) into 4 matches, then place them on the rungs in the correct sequence.</p>
                    <p><strong>Hard Mode:</strong> Theme is never revealed - pure challenge!</p>
                    <p><strong>Easy Mode:</strong> Theme is revealed after your 2nd attempt.</p>
                    <p>New puzzle every day at midnight!</p>
                </div>
            </div>

            <!-- Test Mode Section -->
            <div class="menu-section">
                <h3>üß™ Test Mode</h3>
                <div class="menu-item" style="flex-direction: column; align-items: stretch; gap: 10px;">
                    <label>Select Puzzle:</label>
                    <select id="puzzle-selector" style="padding: 10px; border-radius: 8px; background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); font-size: 0.9rem;">
                        <option value="">-- Daily Puzzle --</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadSelectedPuzzle()" style="margin-top: 5px;">Load Puzzle</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Intro Modal -->
    <div class="modal" id="intro-modal">
        <div class="modal-content" style="max-width: 400px;">
            <h2 style="color: #ffd369; margin-bottom: 20px;">How to Play</h2>
            
            <div class="about-text" style="text-align: left;">
                <p><strong>Goal:</strong> Pair 8 items into 4 conceptual matches, then place them on the rungs in the correct sequence.</p>
                
                <p><strong>Step 1:</strong> Find pairs that together represent a concept</p>
                
                <p><strong>Step 2:</strong> Tap <strong>Place</strong> to add the pair</p>
                
                <p><strong>Step 3:</strong> Order the pairs using ‚ñ≤‚ñº buttons</p>
                
                <p><strong>Step 4:</strong> Tap <strong>Submit</strong> when ready</p>
                
                <p style="margin-top: 15px; padding: 10px; background: #252030; border-radius: 8px;">
                    <strong style="color: #ffd369;">üìè Order Rule:</strong> Rungs always go from <strong>least to most</strong> ‚Äî smaller‚Üílarger, earlier‚Üílater, start‚Üífinish.
                </p>
                
                <p style="margin-top: 10px; padding: 10px; background: #252030; border-radius: 8px;">
                    <strong style="color: #ffd369;">üí° Tip:</strong> In Easy Mode, the theme is revealed after 2 attempts. In Hard Mode, it stays hidden!
                </p>
            </div>
            
            <div style="margin-top: 20px;">
                <label style="display: flex; align-items: center; gap: 10px; font-size: 0.9rem; color: #a89fb0; cursor: pointer;">
                    <input type="checkbox" id="skip-intro-checkbox" style="width: 18px; height: 18px;">
                    Don't show this again
                </label>
            </div>
            
            <button class="btn btn-primary" onclick="closeIntro()" style="margin-top: 20px; width: 100%;">Let's Play!</button>
        </div>
    </div>

    <script>
        // ============ PUZZLE DATABASE ============
        const PUZZLES = [// Puzzle 1: Building Wealth (poorest ‚Üí richest)
            {
                items: [
                    { id: 1, display: 'SPARE', type: 'text' },
                    { id: 2, display: 'CHANGE', type: 'text' },
                    { id: 3, display: 'PIGGY', type: 'text' },
                    { id: 4, display: 'BANK', type: 'text' },
                    { id: 5, display: 'STOCK', type: 'text' },
                    { id: 6, display: 'BROKER', type: 'text' },
                    { id: 7, display: 'TRUST', type: 'text' },
                    { id: 8, display: 'FUND', type: 'text' }
                ],
                // SPARE+CHANGE (coins) ‚Üí PIGGY+BANK (saving) ‚Üí STOCK+BROKER (investing) ‚Üí TRUST+FUND (wealthy)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Building Wealth',
                explanation: 'SPARE+CHANGE (pocket coins) ‚Üí PIGGY+BANK (modest savings) ‚Üí STOCK+BROKER (investments) ‚Üí TRUST+FUND (generational wealth)',
                decoys: ['Banking', 'Wall Street', 'Money Terms'],
                detailedExplanation: `<h4>Financial Growth Stages</h4> <table> <tr><th>Stage</th><th>Pair</th><th>What It Represents</th></tr> <tr><td>1. Broke</td><td>SPARE + CHANGE</td><td>Pocket coins, living paycheck to paycheck</td></tr> <tr><td>2. Saving</td><td>PIGGY + BANK</td><td>Starting to save small amounts</td></tr> <tr><td>3. Investing</td><td>STOCK + BROKER</td><td>Growing wealth through investments</td></tr> <tr><td>4. Wealthy</td><td>TRUST + FUND</td><td>Generational wealth, money manages itself</td></tr> </table> <p>The progression follows how people typically build wealth over a lifetime.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 2: Water Cycle
            {
                items: [
                    { id: 1, display: 'OCEAN', type: 'text' },
                    { id: 2, display: 'HEAT', type: 'text' },
                    { id: 3, display: 'CLOUD', type: 'text' },
                    { id: 4, display: 'FORM', type: 'text' },
                    { id: 5, display: 'RAIN', type: 'text' },
                    { id: 6, display: 'FALL', type: 'text' },
                    { id: 7, display: 'RIVER', type: 'text' },
                    { id: 8, display: 'FLOW', type: 'text' }
                ],
                // OCEAN+HEAT (evaporate) ‚Üí CLOUD+FORM (condense) ‚Üí RAIN+FALL (precipitate) ‚Üí RIVER+FLOW (collect)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Water Cycle',
                explanation: 'OCEAN+HEAT (sun evaporates water) ‚Üí CLOUD+FORM (vapor condenses) ‚Üí RAIN+FALL (precipitation) ‚Üí RIVER+FLOW (water returns to sea)',
                decoys: ['Weather', 'Geography', 'Seasons'],
                detailedExplanation: `<h4>The Hydrological Cycle</h4> <table> <tr><th>Step</th><th>Pair</th><th>Scientific Process</th></tr> <tr><td>1. Evaporation</td><td>OCEAN + HEAT</td><td>Sun heats ocean water, turning it to vapor</td></tr> <tr><td>2. Condensation</td><td>CLOUD + FORM</td><td>Water vapor cools and forms clouds</td></tr> <tr><td>3. Precipitation</td><td>RAIN + FALL</td><td>Water falls back to earth as rain</td></tr> <tr><td>4. Collection</td><td>RIVER + FLOW</td><td>Water flows back toward the ocean</td></tr> </table> <p>This is the continuous cycle that circulates water through Earth's systems.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 3: Career Ladder (entry ‚Üí executive)
            {
                items: [
                    { id: 1, display: 'HELP', type: 'text' },
                    { id: 2, display: 'WANTED', type: 'text' },
                    { id: 3, display: 'TEMP', type: 'text' },
                    { id: 4, display: 'WORK', type: 'text' },
                    { id: 5, display: 'CORNER', type: 'text' },
                    { id: 6, display: 'OFFICE', type: 'text' },
                    { id: 7, display: 'BOARD', type: 'text' },
                    { id: 8, display: 'CHAIR', type: 'text' }
                ],
                // HELP+WANTED (seeking) ‚Üí TEMP+WORK (entry) ‚Üí CORNER+OFFICE (manager) ‚Üí BOARD+CHAIR (executive)
                // Red herring: OFFICE+CHAIR (furniture) - tempting but wrong!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Career Ladder',
                explanation: 'HELP+WANTED (job hunting) ‚Üí TEMP+WORK (starting out) ‚Üí CORNER+OFFICE (management) ‚Üí BOARD+CHAIR (chairman)',
                decoys: ['Office Chair', 'Furniture', 'Signs'],
                detailedExplanation: `<h4>Professional Advancement</h4> <table> <tr><th>Level</th><th>Pair</th><th>Career Stage</th></tr> <tr><td>1. Job Seeker</td><td>HELP + WANTED</td><td>Looking for employment</td></tr> <tr><td>2. Entry Level</td><td>TEMP + WORK</td><td>First job, often temporary or contract</td></tr> <tr><td>3. Management</td><td>CORNER + OFFICE</td><td>Promoted to manager with prime office</td></tr> <tr><td>4. Executive</td><td>BOARD + CHAIR</td><td>Chairman of the board</td></tr> </table> <p>Tricky: OFFICE+CHAIR (furniture) is tempting, but CORNER+OFFICE represents management and BOARD+CHAIR means chairman!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 4: Chain - Computing Evolution
            {
                items: [
                    { id: 1, display: 'PUNCH', type: 'text' },
                    { id: 2, display: 'CARD', type: 'text' },
                    { id: 3, display: 'MAIN', type: 'text' },
                    { id: 4, display: 'FRAME', type: 'text' },
                    { id: 5, display: 'NOTE', type: 'text' },
                    { id: 6, display: 'BOOK', type: 'text' },
                    { id: 7, display: 'SMART', type: 'text' },
                    { id: 8, display: 'WATCH', type: 'text' }
                ],
                // PUNCH CARD, MAINFRAME, NOTEBOOK, SMARTWATCH
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Computing Evolution',
                puzzleType: 'chain',
                explanation: 'Computing got smaller: punch card (1950s) ‚Üí mainframe (1960s) ‚Üí notebook (1990s) ‚Üí smartwatch (2010s)',
                decoys: ['Office Supplies', 'Library', 'Jewelry'],
                difficulty: 'hard',
                detailedExplanation: `
                    <h4>Computing Devices Got Smaller Over Time</h4>
                    <table>
                        <tr><th>Era</th><th>Pair</th><th>Device</th><th>Size</th></tr>
                        <tr><td>1950s</td><td>PUNCH + CARD</td><td>Punch cards fed into room-sized computers</td><td>Building</td></tr>
                        <tr><td>1960s</td><td>MAIN + FRAME</td><td>Mainframe computers</td><td>Room</td></tr>
                        <tr><td>1990s</td><td>NOTE + BOOK</td><td>Notebook/laptop computers</td><td>Briefcase</td></tr>
                        <tr><td>2010s</td><td>SMART + WATCH</td><td>Smartwatch with full computing power</td><td>Wrist</td></tr>
                    </table>
                    <p>The sequence follows the miniaturization of computing from building-sized machines to devices on your wrist.</p>
                `
            },
            ,
            // Puzzle 5: Making Bread
            {
                items: [
                    { id: 1, display: 'FLOUR', type: 'text' },
                    { id: 2, display: 'WATER', type: 'text' },
                    { id: 3, display: 'YEAST', type: 'text' },
                    { id: 4, display: 'BUBBLE', type: 'text' },
                    { id: 5, display: 'OVEN', type: 'text' },
                    { id: 6, display: 'BROWN', type: 'text' },
                    { id: 7, display: 'BUTTER', type: 'text' },
                    { id: 8, display: 'SLICE', type: 'text' }
                ],
                // FLOUR+WATER (mix) ‚Üí YEAST+BUBBLE (rise) ‚Üí OVEN+BROWN (bake) ‚Üí BUTTER+SLICE (serve)
                // Red herring: BROWN+BUTTER (brown butter is a real culinary technique!)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Making Bread',
                explanation: 'FLOUR+WATER (mix dough) ‚Üí YEAST+BUBBLE (dough rises) ‚Üí OVEN+BROWN (bake it) ‚Üí BUTTER+SLICE (serve and eat)',
                decoys: ['Brown Butter', 'Baking', 'Kitchen'],
                detailedExplanation: `<h4>Bread Baking Process</h4> <table> <tr><th>Step</th><th>Pair</th><th>What Happens</th></tr> <tr><td>1. Mix</td><td>FLOUR + WATER</td><td>Combine basic ingredients into dough</td></tr> <tr><td>2. Rise</td><td>YEAST + BUBBLE</td><td>Yeast ferments, creating gas bubbles</td></tr> <tr><td>3. Bake</td><td>OVEN + BROWN</td><td>Heat transforms dough into bread</td></tr> <tr><td>4. Serve</td><td>BUTTER + SLICE</td><td>Cut and serve with butter</td></tr> </table> <p>Tricky: BROWN+BUTTER is a real cooking technique (butter cooked until browned), but here OVEN+BROWN represents baking and BUTTER+SLICE is serving!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 6: A Thunderstorm
            {
                items: [
                    { id: 1, display: 'STILL', type: 'text' },
                    { id: 2, display: 'AIR', type: 'text' },
                    { id: 3, display: 'DARK', type: 'text' },
                    { id: 4, display: 'SKY', type: 'text' },
                    { id: 5, display: 'FLASH', type: 'text' },
                    { id: 6, display: 'BOOM', type: 'text' },
                    { id: 7, display: 'BIRD', type: 'text' },
                    { id: 8, display: 'SING', type: 'text' }
                ],
                // STILL+AIR (calm) ‚Üí DARK+SKY (clouds) ‚Üí FLASH+BOOM (storm) ‚Üí BIRD+SING (clear)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'A Thunderstorm',
                explanation: 'STILL+AIR (calm before storm) ‚Üí DARK+SKY (clouds roll in) ‚Üí FLASH+BOOM (lightning and thunder) ‚Üí BIRD+SING (storm passes)',
                decoys: ['Weather', 'Nature', 'Seasons'],
                detailedExplanation: `<h4>Storm Development Stages</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Weather Condition</th></tr> <tr><td>1. Calm</td><td>STILL + AIR</td><td>Eerie quiet before the storm</td></tr> <tr><td>2. Building</td><td>DARK + SKY</td><td>Clouds gathering, sky darkening</td></tr> <tr><td>3. Storm</td><td>FLASH + BOOM</td><td>Lightning and thunder</td></tr> <tr><td>4. Clearing</td><td>BIRD + SING</td><td>Storm passes, nature resumes</td></tr> </table> <p>The classic progression of a summer thunderstorm.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 7: Feeling Sick (minor ‚Üí critical)
            {
                items: [
                    { id: 1, display: 'RUNNY', type: 'text' },
                    { id: 2, display: 'NOSE', type: 'text' },
                    { id: 3, display: 'SICK', type: 'text' },
                    { id: 4, display: 'DAY', type: 'text' },
                    { id: 5, display: 'BED', type: 'text' },
                    { id: 6, display: 'REST', type: 'text' },
                    { id: 7, display: 'LIFE', type: 'text' },
                    { id: 8, display: 'SUPPORT', type: 'text' }
                ],
                // RUNNY+NOSE (cold) ‚Üí SICK+DAY (miss work) ‚Üí BED+REST (serious) ‚Üí LIFE+SUPPORT (critical)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Feeling Sick',
                explanation: 'RUNNY+NOSE (minor cold) ‚Üí SICK+DAY (stay home) ‚Üí BED+REST (serious illness) ‚Üí LIFE+SUPPORT (critical)',
                decoys: ['Body Parts', 'Sleep', 'Medical'],
                detailedExplanation: `<h4>Illness Severity Scale</h4> <table> <tr><th>Severity</th><th>Pair</th><th>Condition</th></tr> <tr><td>1. Minor</td><td>RUNNY + NOSE</td><td>Common cold symptoms, still functional</td></tr> <tr><td>2. Moderate</td><td>SICK + DAY</td><td>Bad enough to miss work</td></tr> <tr><td>3. Serious</td><td>BED + REST</td><td>Doctor-ordered rest, can't do much</td></tr> <tr><td>4. Critical</td><td>LIFE + SUPPORT</td><td>Hospital ICU, fighting for life</td></tr> </table> <p>From "push through it" to "call 911" - a progression nobody wants to experience.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 8: Growing Up
            {
                items: [
                    { id: 1, display: 'PLAY', type: 'text' },
                    { id: 2, display: 'PEN', type: 'text' },
                    { id: 3, display: 'SAND', type: 'text' },
                    { id: 4, display: 'BOX', type: 'text' },
                    { id: 5, display: 'BACK', type: 'text' },
                    { id: 6, display: 'PACK', type: 'text' },
                    { id: 7, display: 'BRIEF', type: 'text' },
                    { id: 8, display: 'CASE', type: 'text' }
                ],
                // PLAYPEN, SANDBOX, BACKPACK, BRIEFCASE
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Growing Up',
                puzzleType: 'chain',
                explanation: 'Life stages: playpen (baby) ‚Üí sandbox (toddler) ‚Üí backpack (student) ‚Üí briefcase (professional)',
                decoys: ['Childhood', 'Education', 'Business'],
            detailedExplanation: `<h4>Life Stages by Container</h4> <table> <tr><th>Age</th><th>Pair</th><th>What You Carry</th></tr> <tr><td>0-1</td><td>PLAY + PEN</td><td>Baby - contained for safety</td></tr> <tr><td>2-5</td><td>SAND + BOX</td><td>Toddler - outdoor play</td></tr> <tr><td>6-18</td><td>BACK + PACK</td><td>Student - books and homework</td></tr> <tr><td>Adult</td><td>BRIEF + CASE</td><td>Professional - work documents</td></tr> </table> <p>What you carry changes as you grow.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 9: Day at the Beach
            {
                items: [
                    { id: 1, display: 'CAR', type: 'text' },
                    { id: 2, display: 'PARK', type: 'text' },
                    { id: 3, display: 'WAVE', type: 'text' },
                    { id: 4, display: 'POOL', type: 'text' },
                    { id: 5, display: 'TOWEL', type: 'text' },
                    { id: 6, display: 'DRY', type: 'text' },
                    { id: 7, display: 'SUN', type: 'text' },
                    { id: 8, display: 'SET', type: 'text' }
                ],
                // CAR+PARK (arrive) ‚Üí WAVE+POOL (swim) ‚Üí TOWEL+DRY (rest) ‚Üí SUN+SET (leave)
                // Red herring: CAR+POOL (carpool) - tempting but wrong!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Day at the Beach',
                explanation: 'CAR+PARK (arrive at beach) ‚Üí WAVE+POOL (go swimming) ‚Üí TOWEL+DRY (dry off) ‚Üí SUN+SET (time to go home)',
                decoys: ['Carpooling', 'Summer', 'Vacation'],
                detailedExplanation: `<h4>Beach Day Timeline</h4> <table> <tr><th>Time</th><th>Pair</th><th>Activity</th></tr> <tr><td>Morning</td><td>CAR + PARK</td><td>Arrive and find parking</td></tr> <tr><td>Midday</td><td>WAVE + POOL</td><td>Swimming in the wave pool</td></tr> <tr><td>Afternoon</td><td>TOWEL + DRY</td><td>Dry off on the beach</td></tr> <tr><td>Evening</td><td>SUN + SET</td><td>Watch sunset, head home</td></tr> </table> <p>Tricky: CAR+POOL (carpool) is tempting, but WAVE+POOL fits the beach theme!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 10: First Day of School
            {
                items: [
                    { id: 1, display: 'ALARM', type: 'text' },
                    { id: 2, display: 'RING', type: 'text' },
                    { id: 3, display: 'SHIRT', type: 'text' },
                    { id: 4, display: 'BUTTON', type: 'text' },
                    { id: 5, display: 'BUS', type: 'text' },
                    { id: 6, display: 'WAIT', type: 'text' },
                    { id: 7, display: 'DESK', type: 'text' },
                    { id: 8, display: 'SIT', type: 'text' }
                ],
                // ALARM+RING (wake) ‚Üí SHIRT+BUTTON (dress) ‚Üí BUS+WAIT (travel) ‚Üí DESK+SIT (arrive)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'First Day of School',
                explanation: 'ALARM+RING (wake up early) ‚Üí SHIRT+BUTTON (get dressed) ‚Üí BUS+WAIT (catch the bus) ‚Üí DESK+SIT (class begins)',
                decoys: ['Morning', 'Routine', 'Office'],
                detailedExplanation: `<h4>First Day Morning</h4> <table> <tr><th>Time</th><th>Pair</th><th>Activity</th></tr> <tr><td>6:30 AM</td><td>ALARM + RING</td><td>Wake up call</td></tr> <tr><td>7:00 AM</td><td>SHIRT + BUTTON</td><td>Get dressed in new clothes</td></tr> <tr><td>7:30 AM</td><td>BUS + WAIT</td><td>Stand at the bus stop</td></tr> <tr><td>8:00 AM</td><td>DESK + SIT</td><td>Take your seat in class</td></tr> </table> <p>The nervous excitement of starting a new school year!</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 11: Buying a House (looking ‚Üí owning)
            {
                items: [
                    { id: 1, display: 'WINDOW', type: 'text' },
                    { id: 2, display: 'SHOP', type: 'text' },
                    { id: 3, display: 'OPEN', type: 'text' },
                    { id: 4, display: 'DOOR', type: 'text' },
                    { id: 5, display: 'CLOSING', type: 'text' },
                    { id: 6, display: 'COST', type: 'text' },
                    { id: 7, display: 'MOVE', type: 'text' },
                    { id: 8, display: 'IN', type: 'text' }
                ],
                // WINDOW+SHOP (browsing) ‚Üí OPEN+DOOR (viewing) ‚Üí CLOSING+COST (buying) ‚Üí MOVE+IN (owning)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Buying a House',
                explanation: 'WINDOW+SHOP (browsing listings) ‚Üí OPEN+DOOR (touring homes) ‚Üí CLOSING+COST (purchase fees) ‚Üí MOVE+IN (ownership)',
                decoys: ['Real Estate', 'Shopping', 'Home'],
                detailedExplanation: `<h4>Home Buying Journey</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Activity</th></tr> <tr><td>1. Dreaming</td><td>WINDOW + SHOP</td><td>Browsing listings online, imagining</td></tr> <tr><td>2. Touring</td><td>OPEN + DOOR</td><td>Visiting open houses, seeing properties</td></tr> <tr><td>3. Purchasing</td><td>CLOSING + COST</td><td>Finalizing the sale, paying fees</td></tr> <tr><td>4. Owning</td><td>MOVE + IN</td><td>Keys in hand, it's yours!</td></tr> </table> <p>The exciting (and stressful) path to homeownership.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 12: Shortest to Longest Trip
            {
                items: [
                    { id: 1, display: 'SIDE', type: 'text' },
                    { id: 2, display: 'WALK', type: 'text' },
                    { id: 3, display: 'JOY', type: 'text' },
                    { id: 4, display: 'RIDE', type: 'text' },
                    { id: 5, display: 'ROAD', type: 'text' },
                    { id: 6, display: 'TRIP', type: 'text' },
                    { id: 7, display: 'WORLD', type: 'text' },
                    { id: 8, display: 'TOUR', type: 'text' }
                ],
                // SIDEWALK, JOYRIDE, ROADTRIP, WORLDTOUR
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Shortest to Longest Trip',
                explanation: 'Travel distance: a few blocks ‚Üí around town ‚Üí cross country ‚Üí around the world',
                decoys: ['Transportation', 'Vacation Types', 'Music Events'],
            detailedExplanation: `<h4>Travel Distances</h4> <table> <tr><th>Duration</th><th>Pair</th><th>Trip Type</th></tr> <tr><td>Minutes</td><td>SIDE + WALK</td><td>Walking nearby</td></tr> <tr><td>Hours</td><td>JOY + RIDE</td><td>Casual drive for fun</td></tr> <tr><td>Days</td><td>ROAD + TRIP</td><td>Multi-day driving adventure</td></tr> <tr><td>Weeks</td><td>WORLD + TOUR</td><td>Global travel experience</td></tr> </table> <p>From a stroll to circumnavigating the globe.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 13: Planting a Garden
            {
                items: [
                    { id: 1, display: 'SHOVEL', type: 'text' },
                    { id: 2, display: 'DIRT', type: 'text' },
                    { id: 3, display: 'SEED', type: 'text' },
                    { id: 4, display: 'BED', type: 'text' },
                    { id: 5, display: 'HOSE', type: 'text' },
                    { id: 6, display: 'SPRAY', type: 'text' },
                    { id: 7, display: 'BASKET', type: 'text' },
                    { id: 8, display: 'FULL', type: 'text' }
                ],
                // SHOVEL+DIRT (dig) ‚Üí SEED+BED (plant) ‚Üí HOSE+SPRAY (water) ‚Üí BASKET+FULL (harvest)
                // Red herring: DIRT+BED (garden bed) - tempting but orphans SHOVEL!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Planting a Garden',
                explanation: 'SHOVEL+DIRT (prepare soil) ‚Üí SEED+BED (plant in seedbed) ‚Üí HOSE+SPRAY (water daily) ‚Üí BASKET+FULL (harvest crops)',
                decoys: ['Dirt Bed', 'Farming', 'Outdoors'],
                detailedExplanation: `<h4>Garden Growing Seasons</h4> <table> <tr><th>Season</th><th>Pair</th><th>Activity</th></tr> <tr><td>Early Spring</td><td>SHOVEL + DIRT</td><td>Prepare the soil</td></tr> <tr><td>Spring</td><td>SEED + BED</td><td>Plant seeds in the seedbed</td></tr> <tr><td>Summer</td><td>HOSE + SPRAY</td><td>Water regularly</td></tr> <tr><td>Fall</td><td>BASKET + FULL</td><td>Harvest the crops</td></tr> </table> <p>Tricky: DIRT+BED (garden bed) is tempting, but that orphans SHOVEL! SHOVEL+DIRT means preparing soil.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 14: Cooking an Egg
            {
                items: [
                    { id: 1, display: 'SHELL', type: 'text' },
                    { id: 2, display: 'CRACK', type: 'text' },
                    { id: 3, display: 'PAN', type: 'text' },
                    { id: 4, display: 'SIZZLE', type: 'text' },
                    { id: 5, display: 'SPATULA', type: 'text' },
                    { id: 6, display: 'FLIP', type: 'text' },
                    { id: 7, display: 'PLATE', type: 'text' },
                    { id: 8, display: 'SERVE', type: 'text' }
                ],
                // SHELL+CRACK (break egg) ‚Üí PAN+SIZZLE (fry) ‚Üí SPATULA+FLIP (turn) ‚Üí PLATE+SERVE (eat)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Cooking an Egg',
                explanation: 'SHELL+CRACK (break the egg) ‚Üí PAN+SIZZLE (fry it) ‚Üí SPATULA+FLIP (turn it over) ‚Üí PLATE+SERVE (time to eat)',
                decoys: ['Breakfast', 'Kitchen', 'Chef'],
                detailedExplanation: `<h4>Frying an Egg</h4> <table> <tr><th>Step</th><th>Pair</th><th>Action</th></tr> <tr><td>1. Crack</td><td>SHELL + CRACK</td><td>Break open the egg</td></tr> <tr><td>2. Cook</td><td>PAN + SIZZLE</td><td>Egg hits hot pan</td></tr> <tr><td>3. Flip</td><td>SPATULA + FLIP</td><td>Turn it over (optional)</td></tr> <tr><td>4. Serve</td><td>PLATE + SERVE</td><td>Transfer to plate and eat</td></tr> </table> <p>The timeless breakfast routine, step by step.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 15: Growing Noise (quiet ‚Üí deafening)
            {
                items: [
                    { id: 1, display: 'PIN', type: 'text' },
                    { id: 2, display: 'DROP', type: 'text' },
                    { id: 3, display: 'WHISPER', type: 'text' },
                    { id: 4, display: 'SOFT', type: 'text' },
                    { id: 5, display: 'ALARM', type: 'text' },
                    { id: 6, display: 'BELL', type: 'text' },
                    { id: 7, display: 'SONIC', type: 'text' },
                    { id: 8, display: 'BOOM', type: 'text' }
                ],
                // PIN+DROP (silent) ‚Üí WHISPER+SOFT (quiet) ‚Üí ALARM+BELL (loud) ‚Üí SONIC+BOOM (deafening)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Growing Noise',
                explanation: 'PIN+DROP (near silence) ‚Üí WHISPER+SOFT (quiet) ‚Üí ALARM+BELL (loud) ‚Üí SONIC+BOOM (deafening)',
                decoys: ['Sounds', 'Music', 'Aviation'],
                detailedExplanation: `<h4>Sound Intensity Scale</h4> <table> <tr><th>Level</th><th>Pair</th><th>Decibels</th></tr> <tr><td>1. Silent</td><td>PIN + DROP</td><td>~10 dB - near total silence</td></tr> <tr><td>2. Quiet</td><td>WHISPER + SOFT</td><td>~30 dB - barely audible</td></tr> <tr><td>3. Loud</td><td>ALARM + BELL</td><td>~80 dB - startling</td></tr> <tr><td>4. Deafening</td><td>SONIC + BOOM</td><td>~150 dB - can cause hearing damage</td></tr> </table> <p>From "you could hear a pin drop" to window-shattering sonic booms.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 16: GR-8 Words
            {
                items: [
                    { id: 1, display: 'SK', type: 'text' },
                    { id: 2, display: '8', type: 'text' },
                    { id: 3, display: 'PL', type: 'text' },
                    { id: 4, display: 'VIII', type: 'text' },
                    { id: 5, display: 'CR', type: 'text' },
                    { id: 6, display: '8Ô∏è‚É£', type: 'emoji' },
                    { id: 7, display: 'ST', type: 'text' },
                    { id: 8, display: 'ATE', type: 'text' }
                ],
                // SKATE, PLATE, CRATE, STATE
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Smallest to Largest',
                explanation: 'Size: skate (foot) ‚Üí plate (dinner) ‚Üí crate (shipping) ‚Üí state (geographic)',
                decoys: ['Rhyming Words', 'Sports', 'Geography'],
            detailedExplanation: `<h4>GR-8 Word Sizes</h4> <table> <tr><th>Size</th><th>Pair</th><th>Word</th></tr> <tr><td>Foot-sized</td><td>SK + 8</td><td>SKATE - fits on your foot</td></tr> <tr><td>Dinner-sized</td><td>PL + VIII</td><td>PLATE - holds a meal</td></tr> <tr><td>Box-sized</td><td>CR + 8Ô∏è‚É£</td><td>CRATE - shipping container</td></tr> <tr><td>Geographic</td><td>ST + ATE</td><td>STATE - entire region</td></tr> </table> <p>All words end in the "ate" sound but vary wildly in size.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 17: Making a Movie (concept ‚Üí theater)
            {
                items: [
                    { id: 1, display: 'BRAIN', type: 'text' },
                    { id: 2, display: 'STORM', type: 'text' },
                    { id: 3, display: 'SCREEN', type: 'text' },
                    { id: 4, display: 'PLAY', type: 'text' },
                    { id: 5, display: 'FILM', type: 'text' },
                    { id: 6, display: 'CREW', type: 'text' },
                    { id: 7, display: 'BOX', type: 'text' },
                    { id: 8, display: 'OFFICE', type: 'text' }
                ],
                // BRAIN+STORM (idea) ‚Üí SCREEN+PLAY (script) ‚Üí FILM+CREW (production) ‚Üí BOX+OFFICE (release)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Making a Movie',
                explanation: 'BRAIN+STORM (generate ideas) ‚Üí SCREEN+PLAY (write script) ‚Üí FILM+CREW (shoot movie) ‚Üí BOX+OFFICE (theatrical release)',
                decoys: ['Hollywood', 'Writing', 'Business'],
                detailedExplanation: `<h4>Film Production Phases</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Industry Term</th></tr> <tr><td>1. Development</td><td>BRAIN + STORM</td><td>Generating and pitching ideas</td></tr> <tr><td>2. Pre-Production</td><td>SCREEN + PLAY</td><td>Writing the script</td></tr> <tr><td>3. Production</td><td>FILM + CREW</td><td>Actually shooting the movie</td></tr> <tr><td>4. Distribution</td><td>BOX + OFFICE</td><td>Theatrical release and revenue</td></tr> </table> <p>Every Hollywood blockbuster follows this path from idea to theater.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 18: Going Fishing
            {
                items: [
                    { id: 1, display: 'ROD', type: 'text' },
                    { id: 2, display: 'CAST', type: 'text' },
                    { id: 3, display: 'FLOAT', type: 'text' },
                    { id: 4, display: 'BOB', type: 'text' },
                    { id: 5, display: 'LINE', type: 'text' },
                    { id: 6, display: 'TUG', type: 'text' },
                    { id: 7, display: 'NET', type: 'text' },
                    { id: 8, display: 'SCOOP', type: 'text' }
                ],
                // ROD+CAST (throw line) ‚Üí FLOAT+BOB (wait) ‚Üí LINE+TUG (bite!) ‚Üí NET+SCOOP (catch)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Going Fishing',
                explanation: 'ROD+CAST (throw out line) ‚Üí FLOAT+BOB (wait patiently) ‚Üí LINE+TUG (fish bites!) ‚Üí NET+SCOOP (land the catch)',
                decoys: ['Lake', 'Hobby', 'Outdoors'],
                detailedExplanation: `<h4>Fishing Sequence</h4> <table> <tr><th>Step</th><th>Pair</th><th>Action</th></tr> <tr><td>1. Cast</td><td>ROD + CAST</td><td>Throw your line into the water</td></tr> <tr><td>2. Wait</td><td>FLOAT + BOB</td><td>Watch the bobber, be patient</td></tr> <tr><td>3. Bite</td><td>LINE + TUG</td><td>Fish takes the bait!</td></tr> <tr><td>4. Catch</td><td>NET + SCOOP</td><td>Land the fish</td></tr> </table> <p>The patient art of fishing, from cast to catch.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 19: Playing Cards
            {
                items: [
                    { id: 1, display: 'SHUFFLE', type: 'text' },
                    { id: 2, display: 'DECK', type: 'text' },
                    { id: 3, display: 'DEAL', type: 'text' },
                    { id: 4, display: 'HAND', type: 'text' },
                    { id: 5, display: 'SIDE', type: 'text' },
                    { id: 6, display: 'BET', type: 'text' },
                    { id: 7, display: 'SHOW', type: 'text' },
                    { id: 8, display: 'DOWN', type: 'text' }
                ],
                // SHUFFLE DECK, DEAL HAND, SIDE BET, SHOWDOWN
                // Red herring: SIDE+SHOW (sideshow) - tempting but wrong!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Playing Cards',
                explanation: 'Poker sequence: shuffle deck ‚Üí deal hand ‚Üí side bet ‚Üí showdown (reveal cards)',
                decoys: ['Sideshow', 'Casino', 'Gambling'],
                detailedExplanation: `<h4>Poker Hand Sequence</h4> <table> <tr><th>Order</th><th>Pair</th><th>Game Action</th></tr> <tr><td>1. Prepare</td><td>SHUFFLE + DECK</td><td>Mix the cards</td></tr> <tr><td>2. Distribute</td><td>DEAL + HAND</td><td>Give cards to players</td></tr> <tr><td>3. Wager</td><td>SIDE + BET</td><td>Additional wager on the side</td></tr> <tr><td>4. Reveal</td><td>SHOW + DOWN</td><td>Players reveal their cards</td></tr> </table> <p>Tricky: SIDE+SHOW (sideshow) is tempting, but SIDE+BET is the poker term!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 20: Cooking Meat (raw ‚Üí done)
            {
                items: [
                    { id: 1, display: 'RAW', type: 'text' },
                    { id: 2, display: 'DEAL', type: 'text' },
                    { id: 3, display: 'RARE', type: 'text' },
                    { id: 4, display: 'BIRD', type: 'text' },
                    { id: 5, display: 'MEDIUM', type: 'text' },
                    { id: 6, display: 'WELL', type: 'text' },
                    { id: 7, display: 'BURNT', type: 'text' },
                    { id: 8, display: 'OUT', type: 'text' }
                ],
                // RAW+DEAL (uncooked) ‚Üí RARE+BIRD (barely cooked) ‚Üí MEDIUM+WELL (properly done) ‚Üí BURNT+OUT (overcooked)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Cooking Meat',
                explanation: 'RAW+DEAL (uncooked) ‚Üí RARE+BIRD (red center) ‚Üí MEDIUM+WELL (pink) ‚Üí BURNT+OUT (charred)',
                decoys: ['Card Games', 'Animals', 'Exhaustion'],
                detailedExplanation: `<h4>Steak Doneness Levels</h4> <table> <tr><th>Level</th><th>Pair</th><th>Internal Temp</th></tr> <tr><td>1. Uncooked</td><td>RAW + DEAL</td><td>Cold, red throughout</td></tr> <tr><td>2. Rare</td><td>RARE + BIRD</td><td>125¬∞F - red center, seared outside</td></tr> <tr><td>3. Medium</td><td>MEDIUM + WELL</td><td>150¬∞F - pink center</td></tr> <tr><td>4. Overdone</td><td>BURNT + OUT</td><td>Charred, past well-done</td></tr> </table> <p>From tartare to hockey puck - know your temperatures!</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 21: Crime and Punishment (minor ‚Üí major)
            {
                items: [
                    { id: 1, display: 'JAY', type: 'text' },
                    { id: 2, display: 'WALK', type: 'text' },
                    { id: 3, display: 'SHOP', type: 'text' },
                    { id: 4, display: 'LIFT', type: 'text' },
                    { id: 5, display: 'CAR', type: 'text' },
                    { id: 6, display: 'JACK', type: 'text' },
                    { id: 7, display: 'BANK', type: 'text' },
                    { id: 8, display: 'HEIST', type: 'text' }
                ],
                // JAY+WALK (ticket) ‚Üí SHOP+LIFT (misdemeanor) ‚Üí CAR+JACK (felony) ‚Üí BANK+HEIST (major crime)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Crime and Punishment',
                explanation: 'JAY+WALK (minor ticket) ‚Üí SHOP+LIFT (misdemeanor) ‚Üí CAR+JACK (violent felony) ‚Üí BANK+HEIST (major crime)',
                decoys: ['Walking', 'Shopping', 'Cars'],
                detailedExplanation: `<h4>Escalating Offenses</h4> <table> <tr><th>Severity</th><th>Pair</th><th>Consequence</th></tr> <tr><td>Infraction</td><td>JAY + WALK</td><td>Small fine, no record</td></tr> <tr><td>Misdemeanor</td><td>SHOP + LIFT</td><td>Possible jail time under 1 year</td></tr> <tr><td>Felony</td><td>CAR + JACK</td><td>Serious prison time</td></tr> <tr><td>Major Crime</td><td>BANK + HEIST</td><td>Federal charges, years in prison</td></tr> </table> <p>From a ticket to federal prison - don't start down this path!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 22: Rocket Launch
            {
                items: [
                    { id: 1, display: 'TEN', type: 'text' },
                    { id: 2, display: 'NINE', type: 'text' },
                    { id: 3, display: 'FLAME', type: 'text' },
                    { id: 4, display: 'ROAR', type: 'text' },
                    { id: 5, display: 'CLOUD', type: 'text' },
                    { id: 6, display: 'PIERCE', type: 'text' },
                    { id: 7, display: 'STAR', type: 'text' },
                    { id: 8, display: 'FLOAT', type: 'text' }
                ],
                // TEN+NINE (countdown) ‚Üí FLAME+ROAR (ignition) ‚Üí CLOUD+PIERCE (ascent) ‚Üí STAR+FLOAT (orbit)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Rocket Launch',
                explanation: 'TEN+NINE (countdown begins) ‚Üí FLAME+ROAR (engines ignite) ‚Üí CLOUD+PIERCE (rocket ascends) ‚Üí STAR+FLOAT (reach orbit)',
                decoys: ['Space', 'NASA', 'Science'],
                detailedExplanation: `<h4>Space Launch Sequence</h4> <table> <tr><th>Phase</th><th>Pair</th><th>What Happens</th></tr> <tr><td>T-10</td><td>TEN + NINE</td><td>Final countdown begins</td></tr> <tr><td>T-0</td><td>FLAME + ROAR</td><td>Engines ignite</td></tr> <tr><td>Ascent</td><td>CLOUD + PIERCE</td><td>Rocket breaks through atmosphere</td></tr> <tr><td>Orbit</td><td>STAR + FLOAT</td><td>Weightlessness achieved in space</td></tr> </table> <p>The dramatic sequence from countdown to orbit!</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 23: Starting a Business (idea ‚Üí success)
            {
                items: [
                    { id: 1, display: 'BRAIN', type: 'text' },
                    { id: 2, display: 'CHILD', type: 'text' },
                    { id: 3, display: 'BUSINESS', type: 'text' },
                    { id: 4, display: 'PLAN', type: 'text' },
                    { id: 5, display: 'GRAND', type: 'text' },
                    { id: 6, display: 'OPENING', type: 'text' },
                    { id: 7, display: 'PROFIT', type: 'text' },
                    { id: 8, display: 'MARGIN', type: 'text' }
                ],
                // BRAIN+CHILD (idea) ‚Üí BUSINESS+PLAN (planning) ‚Üí GRAND+OPENING (launch) ‚Üí PROFIT+MARGIN (success)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Starting a Business',
                explanation: 'BRAIN+CHILD (the idea) ‚Üí BUSINESS+PLAN (document it) ‚Üí GRAND+OPENING (launch day) ‚Üí PROFIT+MARGIN (making money)',
                decoys: ['Parenting', 'Events', 'Finance'],
                detailedExplanation: `<h4>Entrepreneurship Journey</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Milestone</th></tr> <tr><td>1. Ideation</td><td>BRAIN + CHILD</td><td>Your "baby" - the initial concept</td></tr> <tr><td>2. Planning</td><td>BUSINESS + PLAN</td><td>Document strategy for investors</td></tr> <tr><td>3. Launch</td><td>GRAND + OPENING</td><td>Doors open to customers</td></tr> <tr><td>4. Success</td><td>PROFIT + MARGIN</td><td>Actually making money!</td></tr> </table> <p>From napkin sketch to profitable business.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 24: Poker Hands
            {
                items: [
                    { id: 1, display: 'HIGH', type: 'text' },
                    { id: 2, display: 'FIVE', type: 'text' },
                    { id: 3, display: 'STRAIGHT', type: 'text' },
                    { id: 4, display: 'EDGE', type: 'text' },
                    { id: 5, display: 'FULL', type: 'text' },
                    { id: 6, display: 'HOUSE', type: 'text' },
                    { id: 7, display: 'ROYAL', type: 'text' },
                    { id: 8, display: 'FLUSH', type: 'text' }
                ],
                // HIGHFIVE, STRAIGHTEDGE, FULLHOUSE, ROYALFLUSH
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Worst to Best Hand',
                explanation: 'Poker rankings: high card ‚Üí straight ‚Üí full house ‚Üí royal flush',
                decoys: ['Gestures', 'TV Shows', 'Bathroom Terms'],
            detailedExplanation: `<h4>Poker Hand Rankings</h4> <table> <tr><th>Rank</th><th>Pair</th><th>Hand</th></tr> <tr><td>Lowest</td><td>HIGH + FIVE</td><td>High Card (no pairs)</td></tr> <tr><td>Low</td><td>STRAIGHT + EDGE</td><td>Straight (5 in sequence)</td></tr> <tr><td>High</td><td>FULL + HOUSE</td><td>Full House (3 + 2 of a kind)</td></tr> <tr><td>Highest</td><td>ROYAL + FLUSH</td><td>Royal Flush (10-J-Q-K-A suited)</td></tr> </table> <p>Official poker rankings - royal flush beats everything!</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 25: Relationship Stages (casual ‚Üí committed)
            {
                items: [
                    { id: 1, display: 'BLIND', type: 'text' },
                    { id: 2, display: 'DATE', type: 'text' },
                    { id: 3, display: 'FIRST', type: 'text' },
                    { id: 4, display: 'KISS', type: 'text' },
                    { id: 5, display: 'DIAMOND', type: 'text' },
                    { id: 6, display: 'RING', type: 'text' },
                    { id: 7, display: 'HONEY', type: 'text' },
                    { id: 8, display: 'MOON', type: 'text' }
                ],
                // BLIND+DATE (meeting) ‚Üí FIRST+KISS (dating) ‚Üí DIAMOND+RING (engaged) ‚Üí HONEY+MOON (married)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Relationship Stages',
                explanation: 'BLIND+DATE (first meeting) ‚Üí FIRST+KISS (dating) ‚Üí DIAMOND+RING (engagement) ‚Üí HONEY+MOON (newlywed)',
                decoys: ['Jewelry', 'Calendar', 'Romance Movies'],
                detailedExplanation: `<h4>Romance Timeline</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Milestone</th></tr> <tr><td>1. Meeting</td><td>BLIND + DATE</td><td>First introduction, nervous energy</td></tr> <tr><td>2. Dating</td><td>FIRST + KISS</td><td>Romance begins</td></tr> <tr><td>3. Engaged</td><td>DIAMOND + RING</td><td>The proposal</td></tr> <tr><td>4. Married</td><td>HONEY + MOON</td><td>Newlywed celebration</td></tr> </table> <p>From strangers to life partners - the classic love story.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 26: Baking a Cake
            {
                items: [
                    { id: 1, display: 'BOWL', type: 'text' },
                    { id: 2, display: 'STIR', type: 'text' },
                    { id: 3, display: 'TIN', type: 'text' },
                    { id: 4, display: 'POUR', type: 'text' },
                    { id: 5, display: 'OVEN', type: 'text' },
                    { id: 6, display: 'BAKE', type: 'text' },
                    { id: 7, display: 'CANDLE', type: 'text' },
                    { id: 8, display: 'BLOW', type: 'text' }
                ],
                // BOWL+STIR (mix) ‚Üí TIN+POUR (fill pan) ‚Üí OVEN+BAKE (cook) ‚Üí CANDLE+BLOW (celebrate)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Baking a Cake',
                explanation: 'BOWL+STIR (mix batter) ‚Üí TIN+POUR (fill the pan) ‚Üí OVEN+BAKE (cook it) ‚Üí CANDLE+BLOW (birthday wish!)',
                decoys: ['Birthday', 'Kitchen', 'Party'],
                detailedExplanation: `<h4>Birthday Cake Process</h4> <table> <tr><th>Step</th><th>Pair</th><th>Action</th></tr> <tr><td>1. Mix</td><td>BOWL + STIR</td><td>Combine ingredients</td></tr> <tr><td>2. Prepare</td><td>TIN + POUR</td><td>Fill the cake pan</td></tr> <tr><td>3. Bake</td><td>OVEN + BAKE</td><td>Heat transforms batter to cake</td></tr> <tr><td>4. Celebrate</td><td>CANDLE + BLOW</td><td>Make a wish!</td></tr> </table> <p>Every birthday cake follows these steps!</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 27: Getting Famous (unknown ‚Üí celebrity)
            {
                items: [
                    { id: 1, display: 'OPEN', type: 'text' },
                    { id: 2, display: 'MIC', type: 'text' },
                    { id: 3, display: 'FAN', type: 'text' },
                    { id: 4, display: 'MAIL', type: 'text' },
                    { id: 5, display: 'SOLD', type: 'text' },
                    { id: 6, display: 'OUT', type: 'text' },
                    { id: 7, display: 'HALL', type: 'text' },
                    { id: 8, display: 'FAME', type: 'text' }
                ],
                // OPEN+MIC (starting) ‚Üí FAN+MAIL (getting recognition) ‚Üí SOLD+OUT (popular) ‚Üí HALL+FAME (legendary)
                // Red herring: MAIL+OUT (mailing something) - tempting but wrong!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Getting Famous',
                explanation: 'OPEN+MIC (amateur start) ‚Üí FAN+MAIL (letters from fans) ‚Üí SOLD+OUT (mainstream success) ‚Üí HALL of FAME (legendary status)',
                decoys: ['Mailing Out', 'Music', 'Concerts'],
                detailedExplanation: `<h4>Path to Stardom</h4> <table> <tr><th>Level</th><th>Pair</th><th>Recognition</th></tr> <tr><td>1. Amateur</td><td>OPEN + MIC</td><td>Performing for free, building skills</td></tr> <tr><td>2. Rising</td><td>FAN + MAIL</td><td>Getting letters from admirers</td></tr> <tr><td>3. Popular</td><td>SOLD + OUT</td><td>Venues at capacity</td></tr> <tr><td>4. Legend</td><td>HALL of + FAME</td><td>Immortalized for contributions</td></tr> </table> <p>Tricky: MAIL+OUT (sending mail) is tempting, but FAN+MAIL represents receiving fan letters!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 28: Look-and-Say Sequence (extremely hard)
            {
                items: [
                    { id: 1, display: '2', type: 'text' },
                    { id: 2, display: '1', type: 'text' },
                    { id: 3, display: '12', type: 'text' },
                    { id: 4, display: '11', type: 'text' },
                    { id: 5, display: '1112', type: 'text' },
                    { id: 6, display: '21', type: 'text' },
                    { id: 7, display: '312', type: 'text' },
                    { id: 8, display: '211', type: 'text' }
                ],
                // Look-and-Say: each term describes the previous
                // 1 ‚Üí 11 ‚Üí 21 ‚Üí 1211 ‚Üí 111221 ‚Üí 312211
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Look-and-Say Sequence',
                explanation: '21 (one 2, one 1) ‚Üí 1211 (one 1, one 2, two 1s) ‚Üí 111221 ‚Üí 312211. Each number describes what you SEE in the previous number.',
                decoys: ['Binary Code', 'Phone Numbers', 'Math Puzzle'],
                detailedExplanation: `<h4>Morris Number Sequence</h4> <table> <tr><th>Term</th><th>Pair</th><th>How to Read It</th></tr> <tr><td>1</td><td>2 + 1</td><td>"Two ones" ‚Üí 21</td></tr> <tr><td>2</td><td>12 + 11</td><td>"One 2, one 1" ‚Üí 1211</td></tr> <tr><td>3</td><td>1112 + 21</td><td>"One 1, one 2, two 1s" ‚Üí 111221</td></tr> <tr><td>4</td><td>312 + 211</td><td>"Three 1s, two 2s, one 1" ‚Üí 312211</td></tr> </table> <p>Each term describes the previous term. The pairing IS the puzzle - you must understand the pattern to pair correctly!</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 29: Writing a Song (inspiration ‚Üí hit)
            {
                items: [
                    { id: 1, display: 'SONG', type: 'text' },
                    { id: 2, display: 'IDEA', type: 'text' },
                    { id: 3, display: 'ROUGH', type: 'text' },
                    { id: 4, display: 'CUT', type: 'text' },
                    { id: 5, display: 'STUDIO', type: 'text' },
                    { id: 6, display: 'TIME', type: 'text' },
                    { id: 7, display: 'CHART', type: 'text' },
                    { id: 8, display: 'TOPPER', type: 'text' }
                ],
                // SONG+IDEA (inspiration) ‚Üí ROUGH+CUT (demo) ‚Üí STUDIO+TIME (recording) ‚Üí CHART+TOPPER (hit)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Writing a Song',
                explanation: 'SONG+IDEA (inspiration) ‚Üí ROUGH+CUT (early demo) ‚Üí STUDIO+TIME (professional recording) ‚Üí CHART+TOPPER (hit single)',
                decoys: ['Music', 'Editing', 'Success'],
                detailedExplanation: `<h4>Music Production Journey</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Activity</th></tr> <tr><td>1. Inspiration</td><td>SONG + IDEA</td><td>A melody or lyric comes to you</td></tr> <tr><td>2. Demo</td><td>ROUGH + CUT</td><td>Record a basic version</td></tr> <tr><td>3. Recording</td><td>STUDIO + TIME</td><td>Professional production</td></tr> <tr><td>4. Success</td><td>CHART + TOPPER</td><td>Number one hit!</td></tr> </table> <p>From shower singing to Billboard charts.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 30: Getting in Trouble (speeding ‚Üí prison)
            {
                items: [
                    { id: 1, display: 'DRIVE', type: 'text' },
                    { id: 2, display: 'FAST', type: 'text' },
                    { id: 3, display: 'CAR', type: 'text' },
                    { id: 4, display: 'CRASH', type: 'text' },
                    { id: 5, display: 'COURT', type: 'text' },
                    { id: 6, display: 'DATE', type: 'text' },
                    { id: 7, display: 'JAIL', type: 'text' },
                    { id: 8, display: 'TIME', type: 'text' }
                ],
                // DRIVE+FAST (speeding) ‚Üí CAR+CRASH (accident) ‚Üí COURT+DATE (trial) ‚Üí JAIL+TIME (prison)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Getting in Trouble',
                explanation: 'DRIVE+FAST (speeding) ‚Üí CAR+CRASH (accident) ‚Üí COURT+DATE (face charges) ‚Üí JAIL+TIME (serve sentence)',
                decoys: ['Racing', 'Vehicles', 'Calendar'],
                detailedExplanation: `<h4>Consequences Escalate</h4> <table> <tr><th>Action</th><th>Pair</th><th>Result</th></tr> <tr><td>1. Speeding</td><td>DRIVE + FAST</td><td>Reckless decision</td></tr> <tr><td>2. Accident</td><td>CAR + CRASH</td><td>Direct consequence</td></tr> <tr><td>3. Charges</td><td>COURT + DATE</td><td>Face the legal system</td></tr> <tr><td>4. Sentence</td><td>JAIL + TIME</td><td>Pay for the crime</td></tr> </table> <p>One bad decision leads to another - a cautionary tale.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 31: Healing an Injury (hurt ‚Üí recovered)
            {
                items: [
                    { id: 1, display: 'PAPER', type: 'text' },
                    { id: 2, display: 'CUT', type: 'text' },
                    { id: 3, display: 'FIRST', type: 'text' },
                    { id: 4, display: 'AID', type: 'text' },
                    { id: 5, display: 'SICK', type: 'text' },
                    { id: 6, display: 'LEAVE', type: 'text' },
                    { id: 7, display: 'CLEAN', type: 'text' },
                    { id: 8, display: 'BILL', type: 'text' }
                ],
                // PAPER+CUT (minor injury) ‚Üí FIRST+AID (treatment) ‚Üí SICK+LEAVE (recovery) ‚Üí CLEAN+BILL (of health)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Healing an Injury',
                explanation: 'PAPER+CUT (ouch) ‚Üí FIRST+AID (bandage it) ‚Üí SICK+LEAVE (time off) ‚Üí CLEAN+BILL of health (recovered)',
                decoys: ['Office', 'Medical', 'Finance'],
                detailedExplanation: `<h4>Recovery Process</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Status</th></tr> <tr><td>1. Injury</td><td>PAPER + CUT</td><td>Ouch! Something happened</td></tr> <tr><td>2. Treatment</td><td>FIRST + AID</td><td>Clean and bandage</td></tr> <tr><td>3. Recovery</td><td>SICK + LEAVE</td><td>Time off to heal</td></tr> <tr><td>4. Healed</td><td>CLEAN + BILL</td><td>Doctor says you're 100%</td></tr> </table> <p>From "ouch" to "all clear" - the healing timeline.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 32: When in Rome (phonetic Roman numerals)
            {
                items: [
                    { id: 1, display: 'SINGLE', type: 'text' },
                    { id: 2, display: 'EYE', type: 'text' },
                    { id: 3, display: 'HAND', type: 'text' },
                    { id: 4, display: 'VEE', type: 'text' },
                    { id: 5, display: 'DIME', type: 'text' },
                    { id: 6, display: 'EX', type: 'text' },
                    { id: 7, display: 'CENTURY', type: 'text' },
                    { id: 8, display: 'SEE', type: 'text' }
                ],
                // Phonetic Roman numerals: I=1, V=5, X=10, C=100
                // Red herring: EYE+SEE ("I see!") is incredibly tempting!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'When in Rome',
                explanation: 'SINGLE+EYE (one=I) ‚Üí HAND+VEE (five=V) ‚Üí DIME+EX (ten=X) ‚Üí CENTURY+SEE (hundred=C). Phonetic Roman numerals!',
                decoys: ['I See', 'Eyesight', 'Letters'],
                detailedExplanation: `<h4>Phonetic Roman Numerals</h4> <table> <tr><th>Value</th><th>Pair</th><th>Why</th></tr> <tr><td>I = 1</td><td>SINGLE + EYE</td><td>"Single" means one, "Eye" sounds like "I"</td></tr> <tr><td>V = 5</td><td>HAND + VEE</td><td>Hand has five fingers, "Vee" sounds like "V"</td></tr> <tr><td>X = 10</td><td>DIME + EX</td><td>Dime is ten cents, "Ex" sounds like "X"</td></tr> <tr><td>C = 100</td><td>CENTURY + SEE</td><td>Century is 100 years, "See" sounds like "C"</td></tr> </table> <p>Deadly trap: EYE+SEE looks like "I see!" but that leaves SINGLE+HAND which doesn't work!</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 33: Getting a Pet (want ‚Üí family)
            {
                items: [
                    { id: 1, display: 'PET', type: 'text' },
                    { id: 2, display: 'STORE', type: 'text' },
                    { id: 3, display: 'PUPPY', type: 'text' },
                    { id: 4, display: 'LOVE', type: 'text' },
                    { id: 5, display: 'HOUSE', type: 'text' },
                    { id: 6, display: 'TRAIN', type: 'text' },
                    { id: 7, display: 'FAMILY', type: 'text' },
                    { id: 8, display: 'DOG', type: 'text' }
                ],
                // PET+STORE (shopping) ‚Üí PUPPY+LOVE (adopt) ‚Üí HOUSE+TRAIN (teaching) ‚Üí FAMILY+DOG (part of family)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Getting a Pet',
                explanation: 'PET+STORE (visit shop) ‚Üí PUPPY+LOVE (fall in love) ‚Üí HOUSE+TRAIN (teach rules) ‚Üí FAMILY+DOG (new family member)',
                decoys: ['Shopping', 'Romance', 'Home'],
                detailedExplanation: `<h4>New Pet Journey</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Experience</th></tr> <tr><td>1. Shopping</td><td>PET + STORE</td><td>Looking at adorable animals</td></tr> <tr><td>2. Bonding</td><td>PUPPY + LOVE</td><td>Falling in love with one</td></tr> <tr><td>3. Training</td><td>HOUSE + TRAIN</td><td>Teaching rules and routines</td></tr> <tr><td>4. Family</td><td>FAMILY + DOG</td><td>Fully integrated family member</td></tr> </table> <p>From "just looking" to "part of the family."</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 34: School Years (youngest ‚Üí graduate)
            {
                items: [
                    { id: 1, display: 'FINGER', type: 'text' },
                    { id: 2, display: 'PAINT', type: 'text' },
                    { id: 3, display: 'RECESS', type: 'text' },
                    { id: 4, display: 'BELL', type: 'text' },
                    { id: 5, display: 'PROM', type: 'text' },
                    { id: 6, display: 'NIGHT', type: 'text' },
                    { id: 7, display: 'CAP', type: 'text' },
                    { id: 8, display: 'GOWN', type: 'text' }
                ],
                // FINGER+PAINT (preschool) ‚Üí RECESS+BELL (elementary) ‚Üí PROM+NIGHT (high school) ‚Üí CAP+GOWN (graduation)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'School Years',
                explanation: 'FINGER+PAINT (preschool) ‚Üí RECESS+BELL (elementary) ‚Üí PROM+NIGHT (high school) ‚Üí CAP+GOWN (graduation)',
                decoys: ['Art Supplies', 'School Events', 'Clothing'],
                detailedExplanation: `<h4>Educational Journey</h4> <table> <tr><th>Age</th><th>Pair</th><th>Stage</th></tr> <tr><td>3-5</td><td>FINGER + PAINT</td><td>Preschool - learning through play</td></tr> <tr><td>6-10</td><td>RECESS + BELL</td><td>Elementary - structured learning begins</td></tr> <tr><td>14-18</td><td>PROM + NIGHT</td><td>High school - social milestones</td></tr> <tr><td>18+</td><td>CAP + GOWN</td><td>Graduation - achievement unlocked</td></tr> </table> <p>From finger painting to diploma - the academic journey.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 35: Learning to Drive (permit ‚Üí freedom)
            {
                items: [
                    { id: 1, display: 'PERMIT', type: 'text' },
                    { id: 2, display: 'TEST', type: 'text' },
                    { id: 3, display: 'PARKING', type: 'text' },
                    { id: 4, display: 'LOT', type: 'text' },
                    { id: 5, display: 'DRIVING', type: 'text' },
                    { id: 6, display: 'SCHOOL', type: 'text' },
                    { id: 7, display: 'ROAD', type: 'text' },
                    { id: 8, display: 'TRIP', type: 'text' }
                ],
                // PERMIT+TEST (get permit) ‚Üí PARKING+LOT (practice) ‚Üí DRIVING+SCHOOL (lessons) ‚Üí ROAD+TRIP (freedom)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Learning to Drive',
                explanation: 'PERMIT+TEST (get learners permit) ‚Üí PARKING+LOT (practice basics) ‚Üí DRIVING+SCHOOL (formal lessons) ‚Üí ROAD+TRIP (earned freedom)',
                decoys: ['Travel', 'School', 'DMV'],
                detailedExplanation: `<h4>Driver's License Journey</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Milestone</th></tr> <tr><td>1. Qualify</td><td>PERMIT + TEST</td><td>Pass written exam, get learner's permit</td></tr> <tr><td>2. Practice</td><td>PARKING + LOT</td><td>Learn basics in empty lots</td></tr> <tr><td>3. Lessons</td><td>DRIVING + SCHOOL</td><td>Professional instruction</td></tr> <tr><td>4. Freedom</td><td>ROAD + TRIP</td><td>License earned, independence achieved</td></tr> </table> <p>The rite of passage every teenager dreams of.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 36: Poker Night (emoji poker hands)
            {
                items: [
                    { id: 1, display: 'HIGH', type: 'text' },
                    { id: 2, display: 'üÉè', type: 'emoji' },
                    { id: 3, display: '3Ô∏è‚É£', type: 'emoji' },
                    { id: 4, display: 'KIND', type: 'text' },
                    { id: 5, display: 'FULL', type: 'text' },
                    { id: 6, display: 'üè†', type: 'emoji' },
                    { id: 7, display: 'üëë', type: 'emoji' },
                    { id: 8, display: 'FLUSH', type: 'text' }
                ],
                // Poker hands worst to best: High Card ‚Üí Three of a Kind ‚Üí Full House ‚Üí Royal Flush
                // Red herring: üëë+HIGH = "Royal Highness" is very tempting!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Poker Night',
                explanation: 'HIGH+üÉè (High Card) ‚Üí 3Ô∏è‚É£+KIND (Three of a Kind) ‚Üí FULL+üè† (Full House) ‚Üí üëë+FLUSH (Royal Flush). Worst to best poker hands!',
                decoys: ['Royal Highness', 'Card Games', 'Gambling'],
                detailedExplanation: `<h4>Poker Hand Rankings</h4> <table> <tr><th>Rank</th><th>Pair</th><th>Hand</th></tr> <tr><td>Weakest</td><td>HIGH + üÉè</td><td>High Card - no matching cards</td></tr> <tr><td>Medium</td><td>3Ô∏è‚É£ + KIND</td><td>Three of a Kind - three matching</td></tr> <tr><td>Strong</td><td>FULL + üè†</td><td>Full House - three + pair</td></tr> <tr><td>Best</td><td>üëë + FLUSH</td><td>Royal Flush - unbeatable hand</td></tr> </table> <p>Deadly trap: üëë+HIGH looks like "Royal Highness" but then üÉè+FLUSH isn't a real hand!</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 37: Falling Asleep (awake ‚Üí deep sleep)
            {
                items: [
                    { id: 1, display: 'NIGHT', type: 'text' },
                    { id: 2, display: 'OWL', type: 'text' },
                    { id: 3, display: 'HEAVY', type: 'text' },
                    { id: 4, display: 'EYELID', type: 'text' },
                    { id: 5, display: 'POWER', type: 'text' },
                    { id: 6, display: 'NAP', type: 'text' },
                    { id: 7, display: 'DEAD', type: 'text' },
                    { id: 8, display: 'SLEEP', type: 'text' }
                ],
                // NIGHT+OWL (staying up late) ‚Üí HEAVY+EYELID (getting sleepy) ‚Üí POWER+NAP (light sleep) ‚Üí DEAD+SLEEP (out cold)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Falling Asleep',
                explanation: 'NIGHT+OWL (wide awake) ‚Üí HEAVY+EYELID (drowsy) ‚Üí POWER+NAP (dozing) ‚Üí DEAD asleep (unconscious)',
                decoys: ['Birds', 'Body Parts', 'Energy'],
                detailedExplanation: `<h4>Sleep Depth Stages</h4> <table> <tr><th>State</th><th>Pair</th><th>Consciousness</th></tr> <tr><td>1. Alert</td><td>NIGHT + OWL</td><td>Wide awake, staying up late</td></tr> <tr><td>2. Drowsy</td><td>HEAVY + EYELID</td><td>Fighting to stay awake</td></tr> <tr><td>3. Light Sleep</td><td>POWER + NAP</td><td>Dozing, easily awakened</td></tr> <tr><td>4. Deep Sleep</td><td>DEAD + SLEEP</td><td>Completely unconscious</td></tr> </table> <p>The journey from "one more episode" to completely out.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 38: Storm Approaching (calm ‚Üí severe)
            {
                items: [
                    { id: 1, display: 'CLEAR', type: 'text' },
                    { id: 2, display: 'SKY', type: 'text' },
                    { id: 3, display: 'WIND', type: 'text' },
                    { id: 4, display: 'GUST', type: 'text' },
                    { id: 5, display: 'THUNDER', type: 'text' },
                    { id: 6, display: 'STORM', type: 'text' },
                    { id: 7, display: 'FLASH', type: 'text' },
                    { id: 8, display: 'FLOOD', type: 'text' }
                ],
                // CLEAR+SKY (fair) ‚Üí WIND+GUST (breezy) ‚Üí THUNDER+STORM (storm) ‚Üí FLASH+FLOOD (severe)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Storm Approaching',
                explanation: 'CLEAR+SKY (fair weather) ‚Üí WIND+GUST (getting windy) ‚Üí THUNDER+STORM (storm hits) ‚Üí FLASH+FLOOD (severe damage)',
                decoys: ['Weather', 'Nature', 'Disasters'],
                detailedExplanation: `<h4>Weather Progression</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Conditions</th></tr> <tr><td>1. Fair</td><td>CLEAR + SKY</td><td>Beautiful day, no clouds</td></tr> <tr><td>2. Changing</td><td>WIND + GUST</td><td>Breeze picks up</td></tr> <tr><td>3. Storm</td><td>THUNDER + STORM</td><td>Full storm arrives</td></tr> <tr><td>4. Severe</td><td>FLASH + FLOOD</td><td>Dangerous conditions</td></tr> </table> <p>How quickly weather can change from pleasant to dangerous.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 39: Building Height (ground ‚Üí sky)
            {
                items: [
                    { id: 1, display: 'GROUND', type: 'text' },
                    { id: 2, display: 'FLOOR', type: 'text' },
                    { id: 3, display: 'SECOND', type: 'text' },
                    { id: 4, display: 'STORY', type: 'text' },
                    { id: 5, display: 'PENT', type: 'text' },
                    { id: 6, display: 'HOUSE', type: 'text' },
                    { id: 7, display: 'ROOF', type: 'text' },
                    { id: 8, display: 'TOP', type: 'text' }
                ],
                // GROUND+FLOOR (bottom) ‚Üí SECOND+STORY (middle) ‚Üí PENT+HOUSE (high) ‚Üí ROOF+TOP (highest)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Building Height',
                explanation: 'GROUND+FLOOR (street level) ‚Üí SECOND+STORY (above) ‚Üí PENT+HOUSE (top floor) ‚Üí ROOF+TOP (very top)',
                decoys: ['Real Estate', 'Construction', 'Architecture'],
                detailedExplanation: `<h4>Vertical Position in Building</h4> <table> <tr><th>Height</th><th>Pair</th><th>Location</th></tr> <tr><td>1. Street</td><td>GROUND + FLOOR</td><td>Entry level, lobby</td></tr> <tr><td>2. Low</td><td>SECOND + STORY</td><td>One floor up</td></tr> <tr><td>3. High</td><td>PENT + HOUSE</td><td>Top floor luxury unit</td></tr> <tr><td>4. Highest</td><td>ROOF + TOP</td><td>Above the penthouse</td></tr> </table> <p>From street level to the sky.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 40: Acid Test (pH scale)
            {
                items: [
                    { id: 1, display: 'BATTERY', type: 'text' },
                    { id: 2, display: 'ACID', type: 'text' },
                    { id: 3, display: 'LEMON', type: 'text' },
                    { id: 4, display: 'DROP', type: 'text' },
                    { id: 5, display: 'PURE', type: 'text' },
                    { id: 6, display: 'WATER', type: 'text' },
                    { id: 7, display: 'DRAIN', type: 'text' },
                    { id: 8, display: 'CLEANER', type: 'text' }
                ],
                // pH scale: acidic (low) ‚Üí basic (high)
                // Red herring: ACID+DROP (British candy), LEMON+CLEANER, WATER+DRAIN
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Acid Test',
                explanation: 'BATTERY+ACID (pH~1) ‚Üí LEMON+DROP (pH~2) ‚Üí PURE+WATER (pH 7) ‚Üí DRAIN+CLEANER (pH~14). Acidic to basic!',
                decoys: ['Acid Drop', 'Lemon Cleaner', 'Chemistry'],
                detailedExplanation: `<h4>The pH Scale</h4> <table> <tr><th>pH</th><th>Pair</th><th>Substance</th></tr> <tr><td>~1 (Very Acidic)</td><td>BATTERY + ACID</td><td>Sulfuric acid in car batteries</td></tr> <tr><td>~2 (Acidic)</td><td>LEMON + DROP</td><td>Citrus candy, lemon juice</td></tr> <tr><td>7 (Neutral)</td><td>PURE + WATER</td><td>Distilled water is perfectly neutral</td></tr> <tr><td>~14 (Very Basic)</td><td>DRAIN + CLEANER</td><td>Lye-based cleaners are extremely basic</td></tr> </table> <p>Deadly trap: ACID+DROP is a real British hard candy! But that leaves BATTERY+LEMON which doesn't work.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 41: Becoming Rich (broke ‚Üí wealthy)
            {
                items: [
                    { id: 1, display: 'FLAT', type: 'text' },
                    { id: 2, display: 'BROKE', type: 'text' },
                    { id: 3, display: 'SIDE', type: 'text' },
                    { id: 4, display: 'HUSTLE', type: 'text' },
                    { id: 5, display: 'NEST', type: 'text' },
                    { id: 6, display: 'EGG', type: 'text' },
                    { id: 7, display: 'MONEY', type: 'text' },
                    { id: 8, display: 'BAGS', type: 'text' }
                ],
                // FLAT+BROKE (poor) ‚Üí SIDE+HUSTLE (earning) ‚Üí NEST+EGG (saving) ‚Üí MONEY+BAGS (rich)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Becoming Rich',
                explanation: 'FLAT+BROKE (no money) ‚Üí SIDE+HUSTLE (extra income) ‚Üí NEST+EGG (savings) ‚Üí MONEY+BAGS (wealthy)',
                decoys: ['Housing', 'Birds', 'Shopping'],
                detailedExplanation: `<h4>Wealth Building Stages</h4> <table> <tr><th>Status</th><th>Pair</th><th>Financial State</th></tr> <tr><td>1. Broke</td><td>FLAT + BROKE</td><td>No money at all</td></tr> <tr><td>2. Hustle</td><td>SIDE + HUSTLE</td><td>Working extra to earn more</td></tr> <tr><td>3. Saving</td><td>NEST + EGG</td><td>Building up savings</td></tr> <tr><td>4. Wealthy</td><td>MONEY + BAGS</td><td>More than you need</td></tr> </table> <p>The grind from nothing to abundance.</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 42: Throwing a Party (planning ‚Üí aftermath)
            {
                items: [
                    { id: 1, display: 'GUEST', type: 'text' },
                    { id: 2, display: 'LIST', type: 'text' },
                    { id: 3, display: 'PARTY', type: 'text' },
                    { id: 4, display: 'FAVOR', type: 'text' },
                    { id: 5, display: 'DANCE', type: 'text' },
                    { id: 6, display: 'FLOOR', type: 'text' },
                    { id: 7, display: 'CLEAN', type: 'text' },
                    { id: 8, display: 'UP', type: 'text' }
                ],
                // GUEST+LIST (plan) ‚Üí PARTY+FAVOR (prepare) ‚Üí DANCE+FLOOR (party) ‚Üí CLEAN+UP (after)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Throwing a Party',
                explanation: 'GUEST+LIST (planning) ‚Üí PARTY+FAVOR (preparing) ‚Üí DANCE+FLOOR (partying) ‚Üí CLEAN+UP (aftermath)',
                decoys: ['Events', 'Supplies', 'Chores'],
                detailedExplanation: `<h4>Party Planning Timeline</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Task</th></tr> <tr><td>1. Plan</td><td>GUEST + LIST</td><td>Decide who to invite</td></tr> <tr><td>2. Prepare</td><td>PARTY + FAVOR</td><td>Get supplies and gifts</td></tr> <tr><td>3. Party</td><td>DANCE + FLOOR</td><td>The main event!</td></tr> <tr><td>4. After</td><td>CLEAN + UP</td><td>The not-so-fun part</td></tr> </table> <p>Every great party has the same before and after.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 43: Morning Workout (start ‚Üí finish)
            {
                items: [
                    { id: 1, display: 'WARM', type: 'text' },
                    { id: 2, display: 'UP', type: 'text' },
                    { id: 3, display: 'HEART', type: 'text' },
                    { id: 4, display: 'RATE', type: 'text' },
                    { id: 5, display: 'SWEAT', type: 'text' },
                    { id: 6, display: 'SHOP', type: 'text' },
                    { id: 7, display: 'COOL', type: 'text' },
                    { id: 8, display: 'DOWN', type: 'text' }
                ],
                // WARM+UP (stretch) ‚Üí HEART+RATE (cardio) ‚Üí SWEAT+SHOP (intense) ‚Üí COOL+DOWN (end)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Morning Workout',
                explanation: 'WARM+UP (stretch first) ‚Üí HEART+RATE (cardio starts) ‚Üí SWEAT+SHOP (peak intensity) ‚Üí COOL+DOWN (recover)',
                decoys: ['Temperature', 'Medical', 'Shopping'],
                detailedExplanation: `<h4>Exercise Session</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Activity</th></tr> <tr><td>1. Prepare</td><td>WARM + UP</td><td>Light stretching, get blood flowing</td></tr> <tr><td>2. Cardio</td><td>HEART + RATE</td><td>Elevated heart rate exercise</td></tr> <tr><td>3. Peak</td><td>SWEAT + SHOP</td><td>Maximum intensity</td></tr> <tr><td>4. Recover</td><td>COOL + DOWN</td><td>Slow down, stretch, breathe</td></tr> </table> <p>Never skip the warm-up or cool-down!</p>`,
                difficulty: 'medium'
            },
            ,
            // Puzzle 44: Wind Scale (Beaufort scale)
            {
                items: [
                    { id: 1, display: 'GLASS', type: 'text' },
                    { id: 2, display: 'LAKE', type: 'text' },
                    { id: 3, display: 'KITE', type: 'text' },
                    { id: 4, display: 'SURF', type: 'text' },
                    { id: 5, display: 'WIND', type: 'text' },
                    { id: 6, display: 'FARM', type: 'text' },
                    { id: 7, display: 'STORM', type: 'text' },
                    { id: 8, display: 'CHASE', type: 'text' }
                ],
                // Beaufort scale: calm ‚Üí hurricane
                // Red herring: WIND+SURF (windsurfing) is MORE famous than kitesurfing!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Wind Scale',
                explanation: 'GLASS+LAKE (dead calm) ‚Üí KITE+SURF (light breeze) ‚Üí WIND+FARM (strong wind) ‚Üí STORM+CHASE (severe). Beaufort wind scale!',
                decoys: ['Windsurfing', 'Weather', 'Sports'],
                detailedExplanation: `<h4>Beaufort Wind Scale</h4> <table> <tr><th>Force</th><th>Pair</th><th>Conditions</th></tr> <tr><td>0 - Calm</td><td>GLASS + LAKE</td><td>Mirror-like water, no wind</td></tr> <tr><td>3-4 - Light</td><td>KITE + SURF</td><td>Enough wind for kitesurfing</td></tr> <tr><td>6-7 - Strong</td><td>WIND + FARM</td><td>Optimal for wind turbines</td></tr> <tr><td>10+ - Severe</td><td>STORM + CHASE</td><td>Tornado hunters pursue severe weather</td></tr> </table> <p>Deadly trap: WIND+SURF (windsurfing) is more famous than kitesurfing! But that leaves KITE+FARM which makes no sense.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 45: Morning Coffee (waking up ‚Üí alert)
            {
                items: [
                    { id: 1, display: 'SNOOZE', type: 'text' },
                    { id: 2, display: 'BUTTON', type: 'text' },
                    { id: 3, display: 'FRENCH', type: 'text' },
                    { id: 4, display: 'PRESS', type: 'text' },
                    { id: 5, display: 'COFFEE', type: 'text' },
                    { id: 6, display: 'BREAK', type: 'text' },
                    { id: 7, display: 'WIDE', type: 'text' },
                    { id: 8, display: 'AWAKE', type: 'text' }
                ],
                // SNOOZE+BUTTON (still sleepy) ‚Üí FRENCH+PRESS (make coffee) ‚Üí COFFEE+BREAK (drink it) ‚Üí WIDE+AWAKE (alert)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Morning Coffee',
                explanation: 'SNOOZE+BUTTON (groggy) ‚Üí FRENCH+PRESS (brew coffee) ‚Üí COFFEE+BREAK (drinking) ‚Üí WIDE+AWAKE (fully alert)',
                decoys: ['Alarm', 'Cooking', 'Exercise'],
                detailedExplanation: `<h4>Caffeine Activation</h4> <table> <tr><th>State</th><th>Pair</th><th>Alertness</th></tr> <tr><td>1. Groggy</td><td>SNOOZE + BUTTON</td><td>Still half asleep</td></tr> <tr><td>2. Brewing</td><td>FRENCH + PRESS</td><td>Making the coffee</td></tr> <tr><td>3. Drinking</td><td>COFFEE + BREAK</td><td>Consuming caffeine</td></tr> <tr><td>4. Alert</td><td>WIDE + AWAKE</td><td>Fully functional human</td></tr> </table> <p>The transformation from zombie to person.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 46: Having a Baby (conception ‚Üí birth)
            {
                items: [
                    { id: 1, display: 'DUE', type: 'text' },
                    { id: 2, display: 'DATE', type: 'text' },
                    { id: 3, display: 'BABY', type: 'text' },
                    { id: 4, display: 'BUMP', type: 'text' },
                    { id: 5, display: 'WATER', type: 'text' },
                    { id: 6, display: 'BREAK', type: 'text' },
                    { id: 7, display: 'BIRTH', type: 'text' },
                    { id: 8, display: 'DAY', type: 'text' }
                ],
                // DUE+DATE (learn pregnant) ‚Üí BABY+BUMP (showing) ‚Üí WATER+BREAK (labor starts) ‚Üí BIRTH+DAY (baby born)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Having a Baby',
                explanation: 'DUE+DATE (doctor visit) ‚Üí BABY+BUMP (visible pregnancy) ‚Üí WATER+BREAK (labor begins) ‚Üí BIRTH+DAY (baby arrives)',
                decoys: ['Calendar', 'Party', 'Swimming'],
                detailedExplanation: `<h4>Pregnancy Journey</h4> <table> <tr><th>Stage</th><th>Pair</th><th>Milestone</th></tr> <tr><td>1. Confirm</td><td>DUE + DATE</td><td>Doctor confirms pregnancy</td></tr> <tr><td>2. Show</td><td>BABY + BUMP</td><td>Pregnancy becomes visible</td></tr> <tr><td>3. Labor</td><td>WATER + BREAK</td><td>Contractions begin</td></tr> <tr><td>4. Birth</td><td>BIRTH + DAY</td><td>Baby arrives!</td></tr> </table> <p>The nine-month journey to parenthood.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 47: Restaurant Experience (arrive ‚Üí leave)
            {
                items: [
                    { id: 1, display: 'TABLE', type: 'text' },
                    { id: 2, display: 'WAIT', type: 'text' },
                    { id: 3, display: 'BREAD', type: 'text' },
                    { id: 4, display: 'BASKET', type: 'text' },
                    { id: 5, display: 'MAIN', type: 'text' },
                    { id: 6, display: 'COURSE', type: 'text' },
                    { id: 7, display: 'DOGGY', type: 'text' },
                    { id: 8, display: 'BAG', type: 'text' }
                ],
                // TABLE+WAIT (waiting for seat) ‚Üí BREAD+BASKET (appetizer) ‚Üí MAIN+COURSE (entree) ‚Üí DOGGY+BAG (leftovers home)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Restaurant Experience',
                explanation: 'TABLE+WAIT (wait for seating) ‚Üí BREAD+BASKET (starter) ‚Üí MAIN+COURSE (dinner) ‚Üí DOGGY+BAG (take leftovers)',
                decoys: ['Furniture', 'Baking', 'Pets'],
                detailedExplanation: `<h4>Dining Out Timeline</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Activity</th></tr> <tr><td>1. Arrive</td><td>TABLE + WAIT</td><td>Wait for seating</td></tr> <tr><td>2. Appetizer</td><td>BREAD + BASKET</td><td>Complimentary starter</td></tr> <tr><td>3. Entree</td><td>MAIN + COURSE</td><td>The meal you ordered</td></tr> <tr><td>4. Depart</td><td>DOGGY + BAG</td><td>Take leftovers home</td></tr> </table> <p>The full restaurant experience from host stand to exit.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 48: Four Seasons
            {
                items: [
                    { id: 1, display: 'SNOW', type: 'text' },
                    { id: 2, display: 'WHITE', type: 'text' },
                    { id: 3, display: 'RAIN', type: 'text' },
                    { id: 4, display: 'GREEN', type: 'text' },
                    { id: 5, display: 'SKY', type: 'text' },
                    { id: 6, display: 'BLUE', type: 'text' },
                    { id: 7, display: 'DROP', type: 'text' },
                    { id: 8, display: 'BROWN', type: 'text' }
                ],
                // Seasons: Winter ‚Üí Spring ‚Üí Summer ‚Üí Fall
                // Red herring: RAIN+DROP (raindrop) is incredibly common!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Four Seasons',
                explanation: 'SNOW+WHITE (winter) ‚Üí RAIN+GREEN (spring growth) ‚Üí SKY+BLUE (summer) ‚Üí DROP+BROWN (falling leaves). Seasonal cycle!',
                decoys: ['Raindrop', 'Colors', 'Weather'],
                detailedExplanation: `<h4>The Four Seasons</h4> <table> <tr><th>Season</th><th>Pair</th><th>Why</th></tr> <tr><td>Winter</td><td>SNOW + WHITE</td><td>Snow blankets the ground white</td></tr> <tr><td>Spring</td><td>RAIN + GREEN</td><td>Spring rains bring new green growth</td></tr> <tr><td>Summer</td><td>SKY + BLUE</td><td>Clear blue summer skies</td></tr> <tr><td>Fall</td><td>DROP + BROWN</td><td>Brown leaves drop from trees</td></tr> </table> <p>Deadly trap: RAIN+DROP (raindrop) is such a common word! But that leaves SNOW+GREEN which makes no sense for seasons.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 49: Phases of Life (associative pairs)
            {
                items: [
                    { id: 1, display: 'BABY', type: 'text' },
                    { id: 2, display: 'HOSPITAL', type: 'text' },
                    { id: 3, display: 'SCHOOL', type: 'text' },
                    { id: 4, display: 'TEACHER', type: 'text' },
                    { id: 5, display: 'RETIRE', type: 'text' },
                    { id: 6, display: 'GOLF', type: 'text' },
                    { id: 7, display: 'MEMORIAL', type: 'text' },
                    { id: 8, display: 'SPEECH', type: 'text' }
                ],
                // BABY+HOSPITAL=Born, SCHOOL+TEACHER=Grow, RETIRE+GOLF=Decline, MEMORIAL+SPEECH=Die
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Phases of Life',
                explanation: 'BABY+HOSPITAL (born) ‚Üí SCHOOL+TEACHER (grow) ‚Üí RETIRE+GOLF (decline) ‚Üí MEMORIAL+SPEECH (die)',
                decoys: ['Healthcare', 'Education', 'Hobbies'],
                detailedExplanation: `<h4>Human Life Cycle</h4> <table> <tr><th>Phase</th><th>Pair</th><th>Life Stage</th></tr> <tr><td>Born</td><td>BABY + HOSPITAL</td><td>Entering the world</td></tr> <tr><td>Grow</td><td>SCHOOL + TEACHER</td><td>Learning and developing</td></tr> <tr><td>Decline</td><td>RETIRE + GOLF</td><td>Slowing down, enjoying leisure</td></tr> <tr><td>Die</td><td>MEMORIAL + SPEECH</td><td>Being remembered</td></tr> </table> <p>The universal human journey from birth to legacy.</p>`,
                difficulty: 'easy'
            },
            ,
            // Puzzle 50: Bug's Life (metamorphosis)
            {
                items: [
                    { id: 1, display: 'TINY', type: 'text' },
                    { id: 2, display: 'EGG', type: 'text' },
                    { id: 3, display: 'HUNGRY', type: 'text' },
                    { id: 4, display: 'WORM', type: 'text' },
                    { id: 5, display: 'SILK', type: 'text' },
                    { id: 6, display: 'WRAP', type: 'text' },
                    { id: 7, display: 'SPREAD', type: 'text' },
                    { id: 8, display: 'WING', type: 'text' }
                ],
                // Metamorphosis: Egg ‚Üí Larva ‚Üí Pupa ‚Üí Adult
                // Red herring: SILK+WORM (silkworm) is a common word!
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: "Bug's Life",
                explanation: 'TINY+EGG (egg) ‚Üí HUNGRY+WORM (caterpillar) ‚Üí SILK+WRAP (cocoon) ‚Üí SPREAD+WING (butterfly). Complete metamorphosis!',
                decoys: ['Silkworm', 'Insects', 'Nature'],
                detailedExplanation: `<h4>Complete Metamorphosis</h4> <table> <tr><th>Stage</th><th>Pair</th><th>What Happens</th></tr> <tr><td>1. Egg</td><td>TINY + EGG</td><td>Life begins as a tiny egg</td></tr> <tr><td>2. Larva</td><td>HUNGRY + WORM</td><td>Caterpillar eats constantly to grow</td></tr> <tr><td>3. Pupa</td><td>SILK + WRAP</td><td>Wraps itself in silk cocoon</td></tr> <tr><td>4. Adult</td><td>SPREAD + WING</td><td>Emerges as butterfly, spreads wings</td></tr> </table> <p>Deadly trap: SILK+WORM (silkworm) is such a common word! But that leaves HUNGRY+WRAP which makes no sense.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 51: Half Life (radioactive decay chain)
            {
                items: [
                    { id: 1, display: 'YELLOW', type: 'text' },
                    { id: 2, display: 'CAKE', type: 'text' },
                    { id: 3, display: 'WATCH', type: 'text' },
                    { id: 4, display: 'DIAL', type: 'text' },
                    { id: 5, display: 'BASEMENT', type: 'text' },
                    { id: 6, display: 'GAS', type: 'text' },
                    { id: 7, display: 'PIPE', type: 'text' },
                    { id: 8, display: 'LEAD', type: 'text' }
                ],
                // Decay chain: Uranium ‚Üí Radium ‚Üí Radon ‚Üí Lead
                // Red herring: LEAD+PIPE (Clue board game weapon!)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Half Life',
                explanation: 'YELLOW+CAKE (uranium ore) ‚Üí WATCH+DIAL (radium paint) ‚Üí BASEMENT+GAS (radon) ‚Üí PIPE+LEAD (stable lead). Radioactive decay chain!',
                decoys: ['Lead Pipe', 'Clue Game', 'Nuclear'],
                detailedExplanation: `<h4>Radioactive Decay Chain</h4> <table> <tr><th>Element</th><th>Pair</th><th>Connection</th></tr> <tr><td>Uranium</td><td>YELLOW + CAKE</td><td>"Yellowcake" is processed uranium ore</td></tr> <tr><td>Radium</td><td>WATCH + DIAL</td><td>Old watches used radium paint to glow</td></tr> <tr><td>Radon</td><td>BASEMENT + GAS</td><td>Radon gas accumulates in basements</td></tr> <tr><td>Lead</td><td>PIPE + LEAD</td><td>Lead is the stable end of the decay chain</td></tr> </table> <p>Deadly trap: LEAD+PIPE is the murder weapon from Clue! But that leaves BASEMENT+WATCH which doesn't fit the chain.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 52: Stellar Ending (death of a star)
            {
                items: [
                    { id: 1, display: 'SPACE', type: 'text' },
                    { id: 2, display: 'DUST', type: 'text' },
                    { id: 3, display: 'BURN', type: 'text' },
                    { id: 4, display: 'BRIGHT', type: 'text' },
                    { id: 5, display: 'SWELL', type: 'text' },
                    { id: 6, display: 'RED', type: 'text' },
                    { id: 7, display: 'COOL', type: 'text' },
                    { id: 8, display: 'DOWN', type: 'text' }
                ],
                // Star lifecycle: Nebula ‚Üí Main Sequence ‚Üí Red Giant ‚Üí White Dwarf
                // Red herring: BURN+DOWN (burn down a building)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: 'Stellar Ending',
                explanation: 'SPACE+DUST (nebula) ‚Üí BURN+BRIGHT (fusion) ‚Üí SWELL+RED (red giant) ‚Üí COOL+DOWN (white dwarf). Life and death of a star!',
                decoys: ['Burn Down', 'Fire', 'Astronomy'],
                detailedExplanation: `<h4>Life Cycle of a Star</h4> <table> <tr><th>Phase</th><th>Pair</th><th>What Happens</th></tr> <tr><td>Birth</td><td>SPACE + DUST</td><td>Stars form from cosmic dust clouds</td></tr> <tr><td>Main Sequence</td><td>BURN + BRIGHT</td><td>Hydrogen fusion makes the star shine</td></tr> <tr><td>Red Giant</td><td>SWELL + RED</td><td>Star expands and cools to red</td></tr> <tr><td>White Dwarf</td><td>COOL + DOWN</td><td>Remnant slowly cools forever</td></tr> </table> <p>Deadly trap: BURN+DOWN sounds like setting fire to something! But that leaves SPACE+BRIGHT which doesn't fit stellar evolution.</p>`,
                difficulty: 'hard'
            },
            ,
            // Puzzle 53: Gotta Catch 'Em All (Pokemon journey)
            {
                items: [
                    { id: 1, display: 'POKE', type: 'text' },
                    { id: 2, display: 'BALL', type: 'text' },
                    { id: 3, display: 'RARE', type: 'text' },
                    { id: 4, display: 'CATCH', type: 'text' },
                    { id: 5, display: 'GYM', type: 'text' },
                    { id: 6, display: 'BADGE', type: 'text' },
                    { id: 7, display: 'LEAGUE', type: 'text' },
                    { id: 8, display: 'CHAMPION', type: 'text' }
                ],
                // Pokemon journey: Get balls ‚Üí Catch ‚Üí Badges ‚Üí Champion
                // Red herring: CHAMPION+LEAGUE (UEFA soccer!)
                pairs: [[1, 2], [3, 4], [5, 6], [7, 8]],
                order: [0, 1, 2, 3],
                stackName: "Gotta Catch 'Em All",
                explanation: 'POKE+BALL (equipment) ‚Üí RARE+CATCH (catch Pokemon) ‚Üí GYM+BADGE (train) ‚Üí LEAGUE+CHAMPION (victory). Pokemon trainer journey!',
                decoys: ['Champions League', 'Soccer', 'Sports'],
                detailedExplanation: `<h4>Pokemon Trainer Journey</h4> <table> <tr><th>Stage</th><th>Pair</th><th>What Happens</th></tr> <tr><td>1. Start</td><td>POKE + BALL</td><td>Get your Pokeballs from Professor</td></tr> <tr><td>2. Hunt</td><td>RARE + CATCH</td><td>Catch rare Pokemon in the wild</td></tr> <tr><td>3. Train</td><td>GYM + BADGE</td><td>Defeat gym leaders, earn badges</td></tr> <tr><td>4. Victory</td><td>LEAGUE + CHAMPION</td><td>Beat the Elite Four, become Champion</td></tr> </table> <p>Deadly trap: CHAMPION+LEAGUE is UEFA Champions League soccer! But that leaves RARE+BADGE and GYM+CATCH which don't work.</p>`,
                difficulty: 'hard'
            }
        ];

        // ============ GAME STATE ============
        let currentPuzzle = null;
        let selectedItems = []; // Items selected from pool
        let selectedSlot = null; // Rung slot selected for removal
        let stack = [null, null, null, null]; // 4 slots, bottom to top
        let attemptsUsed = 0;
        let gameOver = false;
        let gameWon = false;
        let gameMode = localStorage.getItem('rungsMode') || 'easy';
        let hintRevealed = false;
        let showIntroOnStart = localStorage.getItem('rungsShowIntro') !== 'false';

        // ============ INTRO FUNCTIONS ============
        function showIntro() {
            document.getElementById('intro-modal').classList.add('active');
            document.getElementById('skip-intro-checkbox').checked = false;
        }

        function closeIntro() {
            document.getElementById('intro-modal').classList.remove('active');
            
            if (document.getElementById('skip-intro-checkbox').checked) {
                showIntroOnStart = false;
                localStorage.setItem('rungsShowIntro', 'false');
                updateIntroToggle();
            }
        }

        function toggleIntroSetting() {
            showIntroOnStart = document.getElementById('intro-toggle').checked;
            localStorage.setItem('rungsShowIntro', showIntroOnStart ? 'true' : 'false');
        }

        function updateIntroToggle() {
            const toggle = document.getElementById('intro-toggle');
            if (toggle) {
                toggle.checked = showIntroOnStart;
            }
        }

        // ============ MODE FUNCTIONS ============
        function toggleHardMode() {
            const isHard = document.getElementById('hard-mode-toggle').checked;
            gameMode = isHard ? 'hard' : 'easy';
            localStorage.setItem('rungsMode', gameMode);
            updateThemeHint();
        }

        function updateModeUI() {
            const toggle = document.getElementById('hard-mode-toggle');
            if (toggle) {
                toggle.checked = gameMode === 'hard';
            }
        }

        function updateThemeHint() {
            const subtitle = document.getElementById('subtitle');
            
            if (!currentPuzzle) return;
            
            const defaultText = 'Pair the words. Climb the rungs.';
            const hintText = `Theme: ${currentPuzzle.stackName}`;
            
            if (gameMode === 'hard') {
                // Hard mode: never show hint
                subtitle.textContent = defaultText;
                subtitle.classList.remove('hint-revealed');
            } else if (gameMode === 'easy') {
                // Easy mode: show after 2 failed attempts
                if (attemptsUsed >= 2 && !gameOver) {
                    subtitle.textContent = hintText;
                    if (!hintRevealed) {
                        subtitle.classList.add('hint-revealed');
                        hintRevealed = true;
                        showMessage('Hint revealed!', 'success');
                    }
                } else {
                    subtitle.textContent = defaultText;
                    subtitle.classList.remove('hint-revealed');
                }
            }
        }

        // ============ MENU FUNCTIONS ============
        function openMenu() {
            updateStatsDisplay();
            updateModeUI();
            updateIntroToggle();
            document.getElementById('menu-modal').classList.add('active');
        }

        function closeMenu() {
            document.getElementById('menu-modal').classList.remove('active');
        }

        // ============ DARK MODE ============
        let darkMode = localStorage.getItem('rungsDarkMode') !== 'false';

        function initDarkMode() {
            if (!darkMode) {
                document.documentElement.setAttribute('data-theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            document.getElementById('dark-mode-toggle').checked = darkMode;
        }

        function toggleDarkMode() {
            darkMode = document.getElementById('dark-mode-toggle').checked;
            localStorage.setItem('rungsDarkMode', darkMode);
            
            if (darkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        }

        // ============ STATISTICS ============
        function getStats() {
            try {
                const stats = localStorage.getItem('rungsStats');
                if (stats) {
                    return JSON.parse(stats);
                }
            } catch (e) {
                console.error('Error reading stats:', e);
            }
            return {
                gamesPlayed: 0,
                gamesWon: 0,
                currentStreak: 0,
                maxStreak: 0,
                totalAttempts: 0,
                lastPlayedDate: null
            };
        }

        function saveStats(stats) {
            try {
                localStorage.setItem('rungsStats', JSON.stringify(stats));
            } catch (e) {
                console.error('Error saving stats:', e);
            }
        }

        function getTodayString() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function updateStats(won, attempts) {
            const stats = getStats();
            const today = getTodayString();
            
            // Only count if not already played today
            if (stats.lastPlayedDate === today) {
                return stats;
            }
            
            stats.gamesPlayed++;
            
            if (won) {
                stats.gamesWon++;
                stats.totalAttempts += attempts;
                
                // Check streak
                if (stats.lastPlayedDate) {
                    const lastDate = new Date(stats.lastPlayedDate);
                    const todayDate = new Date(today);
                    const diffDays = Math.floor((todayDate - lastDate) / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 1) {
                        stats.currentStreak++;
                    } else {
                        stats.currentStreak = 1;
                    }
                } else {
                    stats.currentStreak = 1;
                }
                
                if (stats.currentStreak > stats.maxStreak) {
                    stats.maxStreak = stats.currentStreak;
                }
            } else {
                stats.currentStreak = 0;
            }
            
            stats.lastPlayedDate = today;
            saveStats(stats);
            return stats;
        }

        function updateStatsDisplay() {
            const stats = getStats();
            
            document.getElementById('current-streak').textContent = stats.currentStreak;
            document.getElementById('max-streak').textContent = stats.maxStreak;
            document.getElementById('games-played').textContent = stats.gamesPlayed;
            document.getElementById('games-won').textContent = stats.gamesWon;
            
            const winRate = stats.gamesPlayed > 0 
                ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) 
                : 0;
            document.getElementById('win-rate').textContent = winRate + '%';
            
            const avgAttempts = stats.gamesWon > 0 
                ? (stats.totalAttempts / stats.gamesWon).toFixed(1) 
                : '-';
            document.getElementById('avg-attempts').textContent = avgAttempts;
        }

        // ============ DAILY PUZZLE ============
        function getDailySeed() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return parseInt(`${year}${month}${day}`);
        }

        function getDailyPuzzle() {
            const seed = getDailySeed();
            const index = seed % PUZZLES.length;
            return PUZZLES[index];
        }

        function shuffleWithSeed(array, seed) {
            const shuffled = [...array];
            let state = seed;
            
            const random = () => {
                state = (state * 1103515245 + 12345) & 0x7fffffff;
                return state / 0x7fffffff;
            };

            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled;
        }

        // ============ INITIALIZATION ============
        function initGame() {
            // Populate puzzle dropdown for testing
            populatePuzzleDropdown();
            
            currentPuzzle = getDailyPuzzle();
            
            renderPuzzle();
        }
        
        function populatePuzzleDropdown() {
            const dropdown = document.getElementById('puzzle-selector');
            const diffIcon = { easy: 'üü¢', medium: 'üü°', hard: 'üî¥' };
            dropdown.innerHTML = '<option value="">-- Daily Puzzle --</option>' + 
                PUZZLES.map((p, i) => 
                    `<option value="${i}">${diffIcon[p.difficulty] || '‚ö™'} #${i + 1}: ${p.stackName}</option>`
                ).join('');
        }
        
        function loadSelectedPuzzle() {
            const dropdown = document.getElementById('puzzle-selector');
            const index = dropdown.value;
            
            if (index === '') {
                // Load daily puzzle
                currentPuzzle = getDailyPuzzle();
            } else {
                currentPuzzle = PUZZLES[parseInt(index)];
            }
            
            // Don't show intro when testing
            const tempShowIntro = showIntroOnStart;
            showIntroOnStart = false;
            renderPuzzle();
            showIntroOnStart = tempShowIntro;
            
            closeMenu();
        }
        
        function renderPuzzle() {
            // Shuffle items for display (use puzzle index + date for consistent but unique shuffle)
            const puzzleIndex = PUZZLES.indexOf(currentPuzzle);
            const shuffleSeed = getDailySeed() + puzzleIndex;
            const shuffledItems = shuffleWithSeed(currentPuzzle.items, shuffleSeed);
            
            // Create pool
            const pool = document.getElementById('pool');
            pool.innerHTML = '';
            
            shuffledItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item';
                div.dataset.id = item.id;
                
                if (item.type === 'emoji') {
                    div.innerHTML = `<span class="emoji">${item.display}</span>`;
                } else {
                    div.textContent = item.display;
                }
                
                div.onclick = () => selectItem(item.id);
                pool.appendChild(div);
            });
            
            // Reset stack
            stack = [null, null, null, null];
            updateStackDisplay();
            
            // Reset state
            selectedItems = [];
            selectedSlot = null;
            attemptsUsed = 0;
            gameOver = false;
            gameWon = false;
            hintRevealed = false;
            
            updateAttempts();
            updateButtons();
            updateModeUI();
            updateThemeHint();
            updateDifficultyBadge();
            
            // Show intro on first visit
            if (showIntroOnStart) {
                showIntro();
            }
        }

        function updateDifficultyBadge() {
            const badge = document.getElementById('difficulty-badge');
            if (!currentPuzzle || !badge) return;
            
            const diff = currentPuzzle.difficulty || 'medium';
            badge.className = 'difficulty-badge ' + diff;
            badge.textContent = diff;
        }

        // ============ SELECTION ============
        function selectItem(id) {
            if (gameOver) return;
            
            // Clear slot selection when selecting pool items
            if (selectedSlot !== null) {
                document.getElementById(`slot-${selectedSlot}`).classList.remove('selected');
                selectedSlot = null;
            }
            
            const itemEl = document.querySelector(`.item[data-id="${id}"]`);
            if (!itemEl || itemEl.classList.contains('stacked')) return;
            
            const index = selectedItems.indexOf(id);
            
            if (index !== -1) {
                // Deselect
                selectedItems.splice(index, 1);
                itemEl.classList.remove('selected');
            } else if (selectedItems.length < 2) {
                // Select
                selectedItems.push(id);
                itemEl.classList.add('selected');
            }
            
            updateButtons();
        }

        function selectSlot(slotIndex) {
            if (gameOver) return;
            if (stack[slotIndex] === null) return;
            
            // Clear pool selection
            selectedItems.forEach(id => {
                document.querySelector(`.item[data-id="${id}"]`).classList.remove('selected');
            });
            selectedItems = [];
            
            // Toggle slot selection
            if (selectedSlot === slotIndex) {
                document.getElementById(`slot-${slotIndex}`).classList.remove('selected');
                selectedSlot = null;
            } else {
                if (selectedSlot !== null) {
                    document.getElementById(`slot-${selectedSlot}`).classList.remove('selected');
                }
                selectedSlot = slotIndex;
                document.getElementById(`slot-${slotIndex}`).classList.add('selected');
            }
            
            updateButtons();
        }

        // ============ STACK OPERATIONS ============
        function stackSelected() {
            if (selectedItems.length !== 2) return;
            
            // Find next empty slot
            const slotIndex = stack.findIndex(s => s === null);
            if (slotIndex === -1) return;
            
            // Add to stack
            stack[slotIndex] = [...selectedItems];
            
            // Mark items as stacked
            selectedItems.forEach(id => {
                const itemEl = document.querySelector(`.item[data-id="${id}"]`);
                itemEl.classList.remove('selected');
                itemEl.classList.add('stacked');
            });
            
            selectedItems = [];
            updateStackDisplay();
            updateButtons();
            
            // Check if only 2 items remain - auto stack them (but don't auto-submit)
            const remainingItems = document.querySelectorAll('.item:not(.stacked)');
            if (remainingItems.length === 2) {
                setTimeout(() => {
                    // Auto-select and stack the last pair
                    const ids = Array.from(remainingItems).map(el => parseInt(el.dataset.id));
                    const slotIndex = stack.findIndex(s => s === null);
                    stack[slotIndex] = ids;
                    
                    remainingItems.forEach(el => el.classList.add('stacked'));
                    updateStackDisplay();
                    updateButtons();
                }, 300);
            }
        }

        function unstackSelected() {
            if (selectedSlot === null) return;
            
            const pair = stack[selectedSlot];
            if (!pair) return;
            
            // Return items to pool
            pair.forEach(id => {
                const itemEl = document.querySelector(`.item[data-id="${id}"]`);
                itemEl.classList.remove('stacked');
            });
            
            // Remove from stack and collapse
            stack.splice(selectedSlot, 1);
            stack.push(null);
            
            selectedSlot = null;
            updateStackDisplay();
            updateButtons();
        }

        function resetGame() {
            // Return all items to pool
            document.querySelectorAll('.item').forEach(el => {
                el.classList.remove('selected', 'stacked');
            });
            
            // Clear stack
            stack = [null, null, null, null];
            selectedItems = [];
            selectedSlot = null;
            
            updateStackDisplay();
            updateButtons();
        }

        // ============ DISPLAY UPDATES ============
        function updateStackDisplay() {
            // Find the highest filled slot index
            let maxFilledIndex = -1;
            for (let i = 0; i < 4; i++) {
                if (stack[i] !== null) maxFilledIndex = i;
            }
            
            for (let i = 0; i < 4; i++) {
                const slot = document.getElementById(`slot-${i}`);
                const pair = stack[i];
                
                if (pair) {
                    // Get pair display in correct order
                    const { item1, item2, pairIndex } = getCorrectPairDisplay(pair);
                    
                    // Format display as "A & B"
                    const display1 = item1.type === 'emoji' ? `<span style="font-size: 1.3em;">${item1.display}</span>` : item1.display;
                    const display2 = item2.type === 'emoji' ? `<span style="font-size: 1.3em;">${item2.display}</span>` : item2.display;
                    const pairDisplay = `${display1} <span style="color: var(--accent-gold); margin: 0 4px;">&</span> ${display2}`;
                    
                    // Disable up if first filled, disable down if last filled
                    const canMoveUp = i > 0 && stack[i-1] !== null;
                    const canMoveDown = i < maxFilledIndex;
                    
                    slot.innerHTML = `
                        <span class="pair-item">${pairDisplay}</span>
                        <span class="reorder-btns">
                            <button class="reorder-btn" onclick="event.stopPropagation(); moveStackItem(${i}, -1)" ${!canMoveUp ? 'disabled' : ''} title="Move up">‚ñ≤</button>
                            <button class="reorder-btn" onclick="event.stopPropagation(); moveStackItem(${i}, 1)" ${!canMoveDown ? 'disabled' : ''} title="Move down">‚ñº</button>
                        </span>
                    `;
                    slot.classList.add('filled');
                    slot.draggable = true;
                    slot.onclick = () => selectSlot(i);
                } else {
                    slot.innerHTML = '';
                    slot.classList.remove('filled', 'selected', 'drag-over');
                    slot.draggable = false;
                    slot.onclick = null;
                }
            }
        }

        function moveStackItem(index, direction) {
            if (gameOver) return;
            
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex > 3) return;
            if (stack[newIndex] === null) return; // Can't swap with empty slot
            
            // Swap items
            const temp = stack[index];
            stack[index] = stack[newIndex];
            stack[newIndex] = temp;
            
            // Clear selection
            if (selectedSlot !== null) {
                document.getElementById(`slot-${selectedSlot}`).classList.remove('selected');
                selectedSlot = null;
            }
            
            updateStackDisplay();
        }

        function updateButtons() {
            document.getElementById('stack-btn').disabled = selectedItems.length !== 2;
            document.getElementById('unstack-btn').disabled = selectedSlot === null;
            
            const hasStackedItems = stack.some(s => s !== null);
            document.getElementById('reset-btn').disabled = !hasStackedItems && selectedItems.length === 0;
            
            // Submit enabled only when all 4 slots are filled
            const allSlotsFilled = stack.every(s => s !== null);
            document.getElementById('submit-btn').disabled = !allSlotsFilled;
        }

        function updateAttempts() {
            const dots = document.querySelectorAll('.attempt-dot');
            dots.forEach((dot, i) => {
                dot.classList.remove('active', 'used');
                if (i < attemptsUsed) {
                    dot.classList.add('used');
                } else if (i === attemptsUsed) {
                    dot.classList.add('active');
                }
            });
        }

        // ============ VALIDATION ============
        // Helper to display pair in correct order
        // - For emoji/number pairs: use puzzle-defined order
        // - For text-only pairs: alphabetical order
        function getCorrectPairDisplay(pair) {
            // Find which puzzle pair this matches
            for (let i = 0; i < currentPuzzle.pairs.length; i++) {
                const puzzlePair = currentPuzzle.pairs[i];
                if ((pair[0] === puzzlePair[0] && pair[1] === puzzlePair[1]) ||
                    (pair[0] === puzzlePair[1] && pair[1] === puzzlePair[0])) {
                    // Get items in puzzle-defined order
                    let item1 = currentPuzzle.items.find(it => it.id === puzzlePair[0]);
                    let item2 = currentPuzzle.items.find(it => it.id === puzzlePair[1]);
                    
                    // If both are text, sort alphabetically
                    if (item1.type === 'text' && item2.type === 'text') {
                        if (item1.display > item2.display) {
                            [item1, item2] = [item2, item1];
                        }
                    }
                    
                    return { item1, item2, pairIndex: i };
                }
            }
            // No match - return in selection order
            const item1 = currentPuzzle.items.find(it => it.id === pair[0]);
            const item2 = currentPuzzle.items.find(it => it.id === pair[1]);
            return { item1, item2, pairIndex: -1 };
        }

        // Format pair display as "A & B"
        function formatPairDisplay(item1, item2) {
            return `${item1.display} & ${item2.display}`;
        }

        function validateStack() {
            const results = {
                pairs: [],
                orderCorrect: true
            };
            
            // Check each pair
            stack.forEach((pair, stackIndex) => {
                if (!pair) return;
                
                // Use helper to get correct display order
                const { item1, item2, pairIndex } = getCorrectPairDisplay(pair);
                const pairDisplay = formatPairDisplay(item1, item2);
                
                results.pairs.push({
                    display: pairDisplay,
                    correct: pairIndex !== -1,
                    pairIndex: pairIndex
                });
            });
            
            // Check order (only if all pairs are correct)
            const allPairsCorrect = results.pairs.every(p => p.correct);
            
            if (allPairsCorrect) {
                // Check if order matches
                for (let i = 0; i < 4; i++) {
                    if (results.pairs[i].pairIndex !== currentPuzzle.order[i]) {
                        results.orderCorrect = false;
                        break;
                    }
                }
            } else {
                results.orderCorrect = false;
            }
            
            // Determine outcome
            const success = allPairsCorrect && results.orderCorrect;
            
            if (success) {
                gameWon = true;
                gameOver = true;
                showBonusRound();
            } else {
                attemptsUsed++;
                updateAttempts();
                updateThemeHint();
                
                if (attemptsUsed >= 4) {
                    gameOver = true;
                    showFinalResult(false, results);
                } else {
                    showAttemptResult(results);
                }
            }
        }

        // ============ MODALS ============
        function showAttemptResult(results) {
            const modal = document.getElementById('result-modal');
            const content = document.getElementById('result-content');
            
            const pairsHTML = results.pairs.map((p, i) => `
                <div class="result-pair">
                    <span class="pair-text">${i + 1}. ${p.display}</span>
                    <span class="pair-status">${p.correct ? '‚úì' : '‚úó'}</span>
                </div>
            `).join('');
            
            const allPairsCorrect = results.pairs.every(p => p.correct);
            
            // Build order feedback
            let orderHTML = '';
            if (allPairsCorrect && !results.orderCorrect) {
                // Show which positions are correct
                const positionResults = results.pairs.map((p, i) => {
                    const isCorrectPosition = p.pairIndex === currentPuzzle.order[i];
                    return `<span style="color: ${isCorrectPosition ? 'var(--accent-success)' : 'var(--accent-error)'};">${isCorrectPosition ? '‚úì' : '‚úó'}</span>`;
                });
                orderHTML = `
                    <div class="result-order incorrect">
                        Stack Order: ‚úó Wrong
                        <div style="margin-top: 8px; font-size: 0.9rem;">
                            Positions: ${positionResults.join(' ')}
                        </div>
                    </div>
                `;
            } else {
                orderHTML = `
                    <div class="result-order ${results.orderCorrect ? 'correct' : 'incorrect'}">
                        Stack Order: ${results.orderCorrect ? '‚úì Correct' : '‚úó Wrong'}
                        ${!allPairsCorrect ? '<div style="font-size: 0.85rem; margin-top: 5px; opacity: 0.7;">(fix pairs first)</div>' : ''}
                    </div>
                `;
            }
            
            // Show hint reveal message if this was the 2nd attempt in easy mode
            const hintMessage = (attemptsUsed === 2 && gameMode === 'easy') 
                ? `<div style="margin: 15px 0; padding: 12px; background: var(--bg-tertiary); border: 2px solid var(--accent-gold); border-radius: 8px;">üí° Hint revealed: <strong style="color: var(--accent-gold);">${currentPuzzle.stackName}</strong></div>`
                : '';
            
            content.innerHTML = `
                <h2 class="fail">Attempt ${attemptsUsed} Result</h2>
                <div class="result-pairs">
                    ${pairsHTML}
                </div>
                ${orderHTML}
                ${hintMessage}
                <div class="attempts-remaining">
                    ${4 - attemptsUsed} attempt${4 - attemptsUsed !== 1 ? 's' : ''} remaining
                </div>
                <button class="btn btn-primary" onclick="continueGame()">Continue</button>
            `;
            
            modal.classList.add('active');
        }

        function continueGame() {
            document.getElementById('result-modal').classList.remove('active');
            // Don't reset - keep stack intact so player can adjust based on feedback
        }

        function closeResultModal() {
            document.getElementById('result-modal').classList.remove('active');
            // For testing - allows going to menu to pick another puzzle
        }

        function showBonusRound() {
            const modal = document.getElementById('result-modal');
            const content = document.getElementById('result-content');
            
            // Update stats for the win
            updateStats(true, attemptsUsed + 1);
            
            // Shuffle answer options
            const options = [currentPuzzle.stackName, ...currentPuzzle.decoys];
            const shuffledOptions = shuffleWithSeed(options, getDailySeed() + 1);
            
            const optionsHTML = shuffledOptions.map(opt => 
                `<option value="${opt}">${opt}</option>`
            ).join('');
            
            content.innerHTML = `
                <h2 class="success">üéâ Correct!</h2>
                <p>You solved it in ${attemptsUsed + 1} attempt${attemptsUsed > 0 ? 's' : ''}!</p>
                <div class="bonus-section">
                    <label>What is this stack called?</label>
                    <select class="bonus-select" id="bonus-answer">
                        <option value="">Select answer...</option>
                        ${optionsHTML}
                    </select>
                    <button class="btn btn-primary" onclick="submitBonusAnswer()">Submit</button>
                    <button class="btn btn-secondary" onclick="skipBonus()" style="margin-top: 10px;">Skip</button>
                </div>
            `;
            
            modal.classList.add('active');
        }

        function submitBonusAnswer() {
            const answer = document.getElementById('bonus-answer').value;
            if (!answer) {
                showMessage('Please select an answer', 'error');
                return;
            }
            
            const correct = answer === currentPuzzle.stackName;
            showFinalResult(true, null, correct);
        }

        function skipBonus() {
            showFinalResult(true, null, null);
        }

        function showFinalResult(won, results, bonusCorrect) {
            const modal = document.getElementById('result-modal');
            const content = document.getElementById('result-content');
            
            // Update stats for loss (wins are handled in showBonusRound)
            if (!won) {
                updateStats(false, attemptsUsed);
            }
            
            const detailedExp = currentPuzzle.detailedExplanation || '';
            const tellMeMoreHTML = detailedExp ? `
                <button class="tell-me-more-btn" onclick="toggleDetailedExplanation()">üìñ Tell me more</button>
                <div class="detailed-explanation" id="detailed-explanation">
                    ${detailedExp}
                </div>
            ` : '';
            
            if (won) {
                const bonusText = bonusCorrect === true ? 'Bonus: ‚úì' : 
                                  bonusCorrect === false ? 'Bonus: ‚úó' : '';
                
                const explanation = currentPuzzle.explanation || '';
                
                content.innerHTML = `
                    <button class="modal-close-btn" onclick="closeResultModal()">&times;</button>
                    <h2 class="success">üéâ Victory!</h2>
                    <div class="final-result">üèÜ</div>
                    <p>Solved in ${attemptsUsed + 1} attempt${attemptsUsed > 0 ? 's' : ''}!</p>
                    <p style="margin-top: 10px;" class="text-secondary">The stack was: <strong class="text-accent">${currentPuzzle.stackName}</strong></p>
                    ${explanation ? `<p style="margin-top: 8px; font-size: 0.9rem; color: var(--text-muted); font-style: italic;">${explanation}</p>` : ''}
                    ${bonusText ? `<p style="margin-top: 10px;">${bonusText}</p>` : ''}
                    ${tellMeMoreHTML}
                    <div class="share-text" id="share-text"></div>
                    <button class="btn btn-primary" onclick="copyShare()">Share Result</button>
                `;
                
                generateShareText(true, bonusCorrect);
            } else {
                // Build correct answer display with A & B format
                const correctPairsHTML = currentPuzzle.order.map((pairIndex, position) => {
                    const pair = currentPuzzle.pairs[pairIndex];
                    let item1 = currentPuzzle.items.find(it => it.id === pair[0]);
                    let item2 = currentPuzzle.items.find(it => it.id === pair[1]);
                    
                    // If both are text, sort alphabetically
                    if (item1.type === 'text' && item2.type === 'text') {
                        if (item1.display > item2.display) {
                            [item1, item2] = [item2, item1];
                        }
                    }
                    
                    const pairText = `${item1.display} & ${item2.display}`;
                    return `
                        <div class="result-pair" style="background: var(--bg-hover);">
                            <span class="pair-text">${position + 1}. <strong>${pairText}</strong></span>
                        </div>
                    `;
                }).join('');
                
                const explanation = currentPuzzle.explanation || '';
                
                content.innerHTML = `
                    <button class="modal-close-btn" onclick="closeResultModal()">&times;</button>
                    <h2 class="fail">Game Over</h2>
                    <div class="final-result">üòî</div>
                    <p style="margin-bottom: 10px;" class="text-secondary">The correct answer was:</p>
                    <p style="margin-bottom: 5px;"><strong class="text-accent">${currentPuzzle.stackName}</strong></p>
                    ${explanation ? `<p style="margin-bottom: 15px; font-size: 0.9rem; color: var(--text-muted); font-style: italic;">${explanation}</p>` : ''}
                    <div class="result-pairs">
                        ${correctPairsHTML}
                    </div>
                    ${tellMeMoreHTML}
                    <div class="share-text" id="share-text"></div>
                    <button class="btn btn-primary" onclick="copyShare()">Share Result</button>
                `;
                
                generateShareText(false, null);
            }
            
            modal.classList.add('active');
        }

        function toggleDetailedExplanation() {
            const el = document.getElementById('detailed-explanation');
            const btn = document.querySelector('.tell-me-more-btn');
            if (el.classList.contains('show')) {
                el.classList.remove('show');
                btn.textContent = 'üìñ Tell me more';
            } else {
                el.classList.add('show');
                btn.textContent = 'üìñ Hide details';
            }
        }

        function generateShareText(won, bonusCorrect) {
            const today = new Date();
            const dateStr = `${today.getMonth() + 1}/${today.getDate()}/${today.getFullYear()}`;
            const modeStr = gameMode === 'hard' ? 'üî•' : 'üí°';
            
            let result = `Stack ${dateStr} ${modeStr}\n`;
            
            if (won) {
                const attempts = 'üü©'.repeat(attemptsUsed + 1) + '‚¨õ'.repeat(4 - attemptsUsed - 1);
                result += `${attempts}\n`;
                result += `Solved in ${attemptsUsed + 1}/4`;
                if (bonusCorrect === true) result += ' + Bonus ‚≠ê';
            } else {
                result += '‚ùå‚ùå‚ùå‚ùå\n';
                result += '0/4 - Try again tomorrow!';
            }
            
            document.getElementById('share-text').textContent = result;
        }

        function copyShare() {
            const text = document.getElementById('share-text').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showMessage('Copied to clipboard!', 'success');
            }).catch(() => {
                showMessage('Could not copy', 'error');
            });
        }

        // ============ UTILITIES ============
        function showMessage(text, type) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.className = `message ${type} show`;
            
            setTimeout(() => {
                msg.classList.remove('show');
            }, 2000);
        }

        // ============ START ============
        initDarkMode();
        initGame();
        
        // Drag and drop for reordering stack
        let draggedSlot = null;
        
        document.querySelectorAll('.stack-slot').forEach(slot => {
            slot.addEventListener('dragstart', (e) => {
                if (!slot.classList.contains('filled')) {
                    e.preventDefault();
                    return;
                }
                draggedSlot = parseInt(slot.dataset.slot);
                slot.classList.add('dragging');
            });
            
            slot.addEventListener('dragend', () => {
                slot.classList.remove('dragging');
                document.querySelectorAll('.stack-slot').forEach(s => s.classList.remove('drag-over'));
                draggedSlot = null;
            });
            
            slot.addEventListener('dragover', (e) => {
                e.preventDefault();
                if (draggedSlot !== null && slot.classList.contains('filled')) {
                    slot.classList.add('drag-over');
                }
            });
            
            slot.addEventListener('dragleave', () => {
                slot.classList.remove('drag-over');
            });
            
            slot.addEventListener('drop', (e) => {
                e.preventDefault();
                slot.classList.remove('drag-over');
                
                const targetSlot = parseInt(slot.dataset.slot);
                
                if (draggedSlot !== null && draggedSlot !== targetSlot) {
                    // Swap the stack positions
                    const temp = stack[draggedSlot];
                    stack[draggedSlot] = stack[targetSlot];
                    stack[targetSlot] = temp;
                    
                    updateStackDisplay();
                    updateButtons();
                }
            });
        });
        
        // Close menu when clicking outside
        document.getElementById('menu-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMenu();
            }
        });
    </script>
</body>
</html>
